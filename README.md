# REST API ì‹¬ì¸µ íƒêµ¬: ì‹¤ì‹œê°„ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œì˜ ìƒíƒœ ì „ì´ì™€ ë™ì‹œì„± ì œì–´
---
> ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì§ì ‘ êµ¬í˜„í•´ë³´ê³  ì‹¶ì€ ì§€ë¬¸ì„ ë°”íƒ•ìœ¼ë¡œ mvpëª¨ë¸ì„ êµ¬í˜„í•´ë³´ì•˜ìŠµë‹ˆë‹¤.
- ìŠ¤í„°ë”” ì°¸ê³ ë§í¬ : [https://github.com/dong11hyun/DevStudy__CodeReview/tree/main/(%EC%B5%9C%EC%A2%85)%EC%8A%A4%ED%84%B0%EB%94%94%EC%9E%90%EB%A3%8C](https://github.com/dong11hyun/DevStudy__CodeReview/blob/main/(%EC%B5%9C%EC%A2%85)%EC%8A%A4%ED%84%B0%EB%94%94%EC%9E%90%EB%A3%8C/(1%ED%9A%8C%EC%B0%A8)Infra_Backend.md)
> ëŒ€ê·œëª¨ ë°°ë‹¬ í”Œë«í¼ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” **ë™ì‹œì„± ë¬¸ì œ**ì™€ **ë°ì´í„° ì •í•©ì„± ì´ìŠˆ**ë¥¼ 
ë¶„ì„í•˜ê³ , ì´ë¥¼ í•´ê²°í•˜ëŠ” **RESTful API ì„¤ê³„ íŒ¨í„´**ì„ ì—°êµ¬/êµ¬í˜„í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

> ë°°ë‹¬ í”Œë«í¼ì²˜ëŸ¼ ì—¬ëŸ¬ í–‰ìœ„ì(ê³ ê°, ì ì£¼, ë¼ì´ë”)ê°€ ë™ì‹œì— ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°ì‘í•˜ëŠ” ì‹œìŠ¤í…œì—ì„œëŠ” ë°ì´í„° ì •í•©ì„± ë¬¸ì œê°€ í•„ì—°ì ìœ¼ë¡œ ë°œìƒí•©ë‹ˆë‹¤.

> ì´ë¡ ìœ¼ë¡œë§Œ ì•Œê³  ìˆë˜ ë™ì‹œì„± ì œì–´, ë©±ë“±ì„± ë³´ì¥ íŒ¨í„´ì„
ì‹¤ì œë¡œ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í•´ë³´ë©´ì„œ ê¹Šì´ ìˆê²Œ ì´í•´í–ˆë˜ í”„ë¡œì íŠ¸

> ì œì‘ : ê¹€ë™í˜„ ì „ëŒ€ì› / ê¸°ê°„ : 2025_11 ~ 2026_01

## ğŸ“ëª©ì°¨

1. [ğŸ¤”ìƒí™© ë° ë¬¸ì œì ](#ìƒí™©-ë°-ë¬¸ì œì )
   - [ë¬¸ì œ 1. ëª¨í˜¸í•œ ìƒíƒœ ì „ì´ APIğŸ”º](#ë¬¸ì œ-1-ëª¨í˜¸í•œ-ìƒíƒœ-ì „ì´-api)
   - [ë¬¸ì œ 2. ì¹˜ëª…ì ì¸ ë™ì‹œì„± ë¬¸ì œğŸ”º](#ë¬¸ì œ-2-ì¹˜ëª…ì ì¸-ë™ì‹œì„±-ë¬¸ì œ-race-condition)
   - [ë¬¸ì œ 3. ë©±ë“±ì„± ë¶€ì¬ğŸ”º](#ë¬¸ì œ-3-ë©±ë“±ì„±idempotency-ë¶€ì¬)
   - [ë¬¸ì œ 4. ë°ì´í„° ë¡œë”© ë¹„íš¨ìœ¨ğŸ”º](#ë¬¸ì œ-4-ë°ì´í„°-ë¡œë”©-ë¹„íš¨ìœ¨-n1-ë¬¸ì œ)
2. [ğŸ§í•´ê²° ê³¼ì •](#í•´ê²°-ê³¼ì •)
   - [ì§ˆë¬¸ 1: í–‰ìœ„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤ ì„¤ê³„](#ì§ˆë¬¸-1-í–‰ìœ„-ê¸°ë°˜-ë¦¬ì†ŒìŠ¤-ì„¤ê³„)
   - [ì§ˆë¬¸ 2: ë©±ë“±ì„± ë³´ì¥](#ì§ˆë¬¸-2-ë©±ë“±ì„±idempotency-ë³´ì¥)
   - [ì§ˆë¬¸ 3: ë‚™ê´€ì  ë½ êµ¬í˜„](#ì§ˆë¬¸-3-ë‚™ê´€ì -ë½optimistic-locking-êµ¬í˜„)
   - [ì§ˆë¬¸ 4: N+1 ë¬¸ì œ í•´ê²° ì „ëµ](#ì§ˆë¬¸-4-n1-ë¬¸ì œ-í•´ê²°-ì „ëµ)
   - [ì§ˆë¬¸ 5: API ë²„ì „ ê´€ë¦¬ ì „ëµ](#ì§ˆë¬¸-5-api-ë²„ì „-ê´€ë¦¬-ì „ëµ)
3. [ğŸ“– í”„ë¡œì íŠ¸ êµ¬ì¡° & êµ¬í˜„](#-í”„ë¡œì íŠ¸-êµ¬ì¡°--êµ¬í˜„)
   - [í•µì‹¬ í–‰ìœ„ìğŸ”¹](#-í•µì‹¬-í–‰ìœ„ì-actors)
   - [ì£¼ë¬¸ ìƒëª…ì£¼ê¸°ğŸ”¹](#-ì£¼ë¬¸orderì˜-í•µì‹¬-ìƒëª…ì£¼ê¸°)
   - [ì‹¤í–‰ ê°€ì´ë“œğŸ”¹](#-ì‹¤í–‰-ê°€ì´ë“œ)
   - [ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸ğŸ”¹](#-ì£¼ìš”-ì—”ë“œí¬ì¸íŠ¸)
   - [êµ¬í˜„ í˜„í™©ğŸ”¹](#-êµ¬í˜„-í˜„í™©)
   - [í–¥í›„ í™•ì¥ ë° ê°œì„  ê³„íšğŸ”¹](#-í–¥í›„-í™•ì¥-ë°-ê°œì„ -ê³„íš-future-plans)

## ğŸ¤”ìƒí™© ë° ë¬¸ì œì 

- ë‹¹ì‹ ì€ êµ­ë‚´ ìµœëŒ€ ìŒì‹ ë°°ë‹¬ í”Œë«í¼ **QuickEats** ì˜ ì£¼ë¬¸ ì²˜ë¦¬ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ëŠ” ë°±ì—”ë“œ ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤. 
- ì´ ì„œë¹„ìŠ¤ëŠ” ê³ ê°, ë ˆìŠ¤í† ë‘, ë¼ì´ë”ë¼ëŠ” ì„¸ ëª…ì˜ í–‰ìœ„ì(Actor) ì‚¬ì´ì˜ ë³µì¡í•œ ìƒí˜¸ì‘ìš©ì„ ê´€ì¥í•©ë‹ˆë‹¤.
- ì£¼ë¬¸ì˜ ì „ì²´ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” **REST API**ë¥¼ ì™¸ë¶€ì— ì œê³µí•©ë‹ˆë‹¤.
- ì„œë¹„ìŠ¤ V1 APIëŠ” ì´ˆê¸°ì— ë¹ ë¥¸ ê°œë°œì„ ìœ„í•´ **ì£¼ë¬¸(Order)ì´ë¼ëŠ” ë‹¨ì¼ ë¦¬ì†ŒìŠ¤**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. 
- í•˜ì§€ë§Œ ì¼ì¼ ì£¼ë¬¸ëŸ‰ì´ ìˆ˜ë°±ë§Œ ê±´ì„ ë„˜ì–´ì„œë©´ì„œ, **V1 APIì˜ ì„¤ê³„ì  í•œê³„**ê°€ ëª…í™•í•œ ê¸°ìˆ  ë¶€ì±„ë¡œ ëŒì•„ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´, 
- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ëª…í™•íˆ í‘œí˜„í•˜ê³ , 
- ë™ì‹œì„±ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë©°, 
- í´ë¼ì´ì–¸íŠ¸ì™€ íš¨ìœ¨ì ìœ¼ë¡œ ì†Œí†µí•˜ëŠ” **V2 API**ë¥¼ ì„¤ê³„í•´ì•¼ í•©ë‹ˆë‹¤.


#### ğŸ”ºë¬¸ì œ 1. ëª¨í˜¸í•œ ìƒíƒœ ì „ì´ API

**í˜„ì¬ ë°©ì‹:**
```http
PUT /api/v1/orders/{order_id}
Content-Type: application/json

{ "status": "new_status" }
```

**ë¬¸ì œì :**
- ëª¨ë“  ìƒíƒœ ë³€ê²½ì´ ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì²˜ë¦¬ë¨
- ì„œë²„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ê±°ëŒ€í•œ `if-else` ë¶„ê¸°ë¬¸ìœ¼ë¡œ ê°€ë“ ì°¸
- ê³ ê°ì˜ 'ì£¼ë¬¸ ì·¨ì†Œ'ì™€ ë¼ì´ë”ì˜ 'í”½ì—… ì™„ë£Œ'ê°€ ë™ì¼í•œ API ì‚¬ìš©
- ë…¼ë¦¬ì  êµ¬ë¶„ì´ ëª¨í˜¸í•¨

---

#### ğŸ”ºë¬¸ì œ 2. ì¹˜ëª…ì ì¸ ë™ì‹œì„± ë¬¸ì œ (Race Condition)

**ì‹œë‚˜ë¦¬ì˜¤:**
```
ì‹œê°„ T0: ê³ ê°ì´ {"status": "cancelled"} ìš”ì²­ ì „ì†¡
ì‹œê°„ T0: ë ˆìŠ¤í† ë‘ì´ {"status": "preparing"} ìš”ì²­ ì „ì†¡ (ê±°ì˜ ë™ì‹œì—)
ê²°ê³¼: ë°ì´í„°ë² ì´ìŠ¤ ìµœì¢… ìƒíƒœ ì˜ˆì¸¡ ë¶ˆê°€
```

**ê²°ê³¼:**
- ì´ë¯¸ ì·¨ì†Œëœ ì£¼ë¬¸ì˜ ìŒì‹ì´ ì¡°ë¦¬ë¨
- ì‹¬ê°í•œ ë°ì´í„° ë¶ˆì¼ì¹˜ ë¬¸ì œ ë°œìƒ

**ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (V1 API):**
```
=== ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì‹œì‘ (Race Condition) ===
[ê³ ê°] 'ì·¨ì†Œí•´ì£¼ì„¸ìš”!' ìš”ì²­ ë³´ëƒ„
 [ì‚¬ì¥ë‹˜] 'ì£¼ë¬¸ ì ‘ìˆ˜!' ìš”ì²­ ë³´ëƒ„
[ê³ ê°] ì‘ë‹µ ë°›ìŒ: cancelled     â† ê³ ê°ì€ ì·¨ì†Œ ì„±ê³µìœ¼ë¡œ ì¸ì‹
 [ì‚¬ì¥ë‹˜] ì‘ë‹µ ë°›ìŒ: preparing   â† ì‚¬ì¥ë‹˜ì€ ì ‘ìˆ˜ ì„±ê³µìœ¼ë¡œ ì¸ì‹

===  ìµœì¢… ê²°ê³¼ í™•ì¸ ===
DBì— ì €ì¥ëœ ìµœì¢… ìƒíƒœ: preparing   â† ì‹¤ì œë¡œëŠ” ì¡°ë¦¬ ì‹œì‘ë¨!
```
>  **ì¹˜ëª…ì  ë¶ˆì¼ì¹˜**: ê³ ê°ì€ ì·¨ì†Œëœ ì¤„ ì•Œì§€ë§Œ, ì£¼ë°©ì—ì„œëŠ” ì¹˜í‚¨ì„ íŠ€ê¸°ê³  ìˆìŠµë‹ˆë‹¤.
> í…ŒìŠ¤íŠ¸ ì‹¤í–‰: `python black_BOX_test_v1.0.py`

---

#### ğŸ”ºë¬¸ì œ 3. ë©±ë“±ì„±(Idempotency) ë¶€ì¬

**ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤:**
1. ê³ ê°ì´ ê²°ì œ ìš”ì²­ ì „ì†¡
2. ë„¤íŠ¸ì›Œí¬ ë¬¸ì œë¡œ íƒ€ì„ì•„ì›ƒ ë°œìƒ
3. í´ë¼ì´ì–¸íŠ¸ ì•±ì´ ì•ˆì „í•˜ê²Œ ì¬ì‹œë„
4. `POST /api/v1/orders/{order_id}/pay`ê°€ ë©±ë“±ì„± ë¯¸ë³´ì¥
5. **ì¤‘ë³µ ê²°ì œ ë°œìƒ â†’ ê¸ˆìœµ ì‚¬ê³ **

---

#### ğŸ”ºë¬¸ì œ 4. ë°ì´í„° ë¡œë”© ë¹„íš¨ìœ¨ (N+1 ë¬¸ì œ)

**í˜„ì¬ ìƒí™©:**
- `GET /api/v1/orders`ëŠ” `restaurant_id`ì™€ `rider_id`ë§Œ ë°˜í™˜
- í´ë¼ì´ì–¸íŠ¸ê°€ Nê°œ ì£¼ë¬¸ì— ëŒ€í•´ ì¶”ê°€ Në²ˆì˜ API í˜¸ì¶œ í•„ìš”
  - ë ˆìŠ¤í† ë‘ ì •ë³´ ì¡°íšŒ Ã— N
  - ë¼ì´ë” ìœ„ì¹˜ ì¡°íšŒ Ã— N

```
ì´ API í˜¸ì¶œ ìˆ˜ = 1 (ì£¼ë¬¸ ëª©ë¡) + N (ë ˆìŠ¤í† ë‘) + N (ë¼ì´ë”) = 2N + 1
```
---

## ğŸ§í•´ê²° ê³¼ì •

### ì§ˆë¬¸ 1: í–‰ìœ„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤ ì„¤ê³„
- V1 APIì˜ ëª¨í˜¸í•œ ìƒíƒœ ì „ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ì£¼ë¬¸ì˜ ìƒëª…ì£¼ê¸°ë¥¼ RESTfulí•˜ê²Œ í‘œí˜„í•˜ëŠ” APIë¥¼ ìƒˆë¡­ê²Œ ì„¤ê³„í•˜ì‹œì˜¤. 
- PUT ë©”ì„œë“œì— ì˜ì¡´í•˜ëŠ” ëŒ€ì‹ , ì£¼ë¬¸ì˜ ìƒíƒœë¥¼ ë³€ê²½ì‹œí‚¤ëŠ” ê° **'í–‰ìœ„' ìì²´ë¥¼ ë¦¬ì†ŒìŠ¤ë¡œ ê°„ì£¼í•˜ëŠ” 'í–‰ìœ„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤(Action-oriented Resource)' ì ‘ê·¼ë²•**ì„ ì‚¬ìš©í•˜ì—¬ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„¤ê³„í•´ì•¼ í•©ë‹ˆë‹¤. 
- ì˜ˆë¥¼ ë“¤ì–´, ë ˆìŠ¤í† ë‘ì˜ 'ì£¼ë¬¸ ì ‘ìˆ˜' í–‰ìœ„ë‚˜ ê³ ê°ì˜ 'ì£¼ë¬¸ ì·¨ì†Œ' í–‰ìœ„ë¥¼ ìœ„í•œ êµ¬ì²´ì ì¸ ì—”ë“œí¬ì¸íŠ¸(HTTP ë©”ì„œë“œì™€ URI ê²½ë¡œ)ë¥¼ ì œì‹œí•˜ê³ , ì´ëŸ¬í•œ ì„¤ê³„ê°€ ì™œ V1ì— ë¹„í•´ ì‹œìŠ¤í…œì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë” ëª…í™•í•˜ê²Œ ë§Œë“¤ê³  í™•ì¥ì„±ì„ ë†’ì´ëŠ”ì§€ ì„¤ëª…í•˜ì‹œì˜¤.


**[ë‹µë³€]**
>ê¸°ì¡´ V1 APIì—ì„œëŠ” ëª¨ë“  ìƒíƒœ ë³€ê²½ì´ `PUT /api/v1/orders/{order_id}`ë¼ëŠ” ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ `{ "status": "new_status" }` í˜•íƒœë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ë°©ì‹ì€ ë¹ ë¥¸ ê°œë°œì—ëŠ” ìœ ë¦¬í•˜ì§€ë§Œ, ì‹œìŠ¤í…œì´ ì»¤ì§€ë©´ì„œ ì‹¬ê°í•œ ë¬¸ì œë¥¼ ì•¼ê¸°í•©ë‹ˆë‹¤. ì„œë²„ ì½”ë“œëŠ” ì „ë‹¬ë°›ì€ status ê°’ì— ë”°ë¼ ë¶„ê¸°í•´ì•¼ í•˜ë¯€ë¡œ ê±°ëŒ€í•œ if-else ë¸”ë¡ì´ ìƒê¸°ê³ , ëˆ„ê°€ ì–´ë–¤ ìƒíƒœë¡œ ë³€ê²½í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ì½”ë“œ ê¹Šìˆ™ì´ ìˆ¨ê²¨ì§€ê²Œ ë©ë‹ˆë‹¤.

>í–‰ìœ„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤ ì„¤ê³„ëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•©ë‹ˆë‹¤. í•µì‹¬ ì•„ì´ë””ì–´ëŠ” **ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” 'í–‰ìœ„' ìì²´ë¥¼ í•˜ë‚˜ì˜ ë¦¬ì†ŒìŠ¤ë¡œ ê°„ì£¼**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê³ ê°ì´ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ëŠ” í–‰ìœ„ëŠ” `POST /api/v2/orders/{order_id}/cancellation`ìœ¼ë¡œ, ë ˆìŠ¤í† ë‘ì´ ì£¼ë¬¸ì„ ì ‘ìˆ˜í•˜ëŠ” í–‰ìœ„ëŠ” `POST /api/v2/orders/{order_id}/acceptance`ë¡œ í‘œí˜„í•©ë‹ˆë‹¤. ê° í–‰ìœ„ê°€ ë³„ë„ì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê°€ì§€ë¯€ë¡œ, í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ì˜¤ì§ ê·¸ í–‰ìœ„ì— í•„ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë‹´ë‹¹í•˜ë©´ ë©ë‹ˆë‹¤.

>ì´ ì„¤ê³„ì˜ ì¥ì ì€ ëª…í™•í•©ë‹ˆë‹¤. ì²«ì§¸, API ìì²´ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë¬¸ì„œí™”í•©ë‹ˆë‹¤. ê°œë°œìê°€ API ëª…ì„¸ë§Œ ë³´ë”ë¼ë„ "ì£¼ë¬¸ ì·¨ì†ŒëŠ” cancellation ì—”ë“œí¬ì¸íŠ¸ë¡œ, ì£¼ë¬¸ ì ‘ìˆ˜ëŠ” acceptance ì—”ë“œí¬ì¸íŠ¸ë¡œ í•œë‹¤"ëŠ” ê²ƒì„ ì¦‰ì‹œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‘˜ì§¸, ê¶Œí•œ ê²€ì¦ì´ ìš©ì´í•´ì§‘ë‹ˆë‹¤. ê° ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í–‰ìœ„ìë¥¼ ì œí•œí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì˜ˆë¥¼ ë“¤ì–´ cancellationì€ ê³ ê°ë§Œ, acceptanceëŠ” ë ˆìŠ¤í† ë‘ë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ë¯¸ë“¤ì›¨ì–´ ìˆ˜ì¤€ì—ì„œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì…‹ì§¸, í™•ì¥ì„±ì´ ë†’ì•„ì§‘ë‹ˆë‹¤. ìƒˆë¡œìš´ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ìœ¼ë¡œ 'ë¶€ë¶„ í™˜ë¶ˆ' ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ë”ë¼ë„, `POST /api/v2/orders/{order_id}/partial-refund`ë¼ëŠ” ìƒˆ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ ë˜ë©°, ê¸°ì¡´ ì½”ë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.

>ê²°ë¡ ì ìœ¼ë¡œ, í–‰ìœ„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤ ì„¤ê³„ëŠ” RESTì˜ ì›ì¹™ì„ ìœ ì§€í•˜ë©´ì„œë„ ë³µì¡í•œ ìƒíƒœ ê¸°ê³„(State Machine)ë¥¼ ê°€ì§„ ì‹œìŠ¤í…œì„ ê¹”ë”í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ íŒ¨í„´ì…ë‹ˆë‹¤.

---
> PUT ë©”ì„œë“œì— ì˜ì¡´í•˜ëŠ” ëŒ€ì‹ , ì£¼ë¬¸ì˜ ìƒíƒœë¥¼ ë³€ê²½ì‹œí‚¤ëŠ” ê° **'í–‰ìœ„' ìì²´ë¥¼ ë¦¬ì†ŒìŠ¤**ë¡œ ê°„ì£¼

**ì„¤ê³„ ì˜ˆì‹œ:**

| í–‰ìœ„ | HTTP ë©”ì„œë“œ | ì—”ë“œí¬ì¸íŠ¸ | í–‰ìœ„ì |
|------|-------------|-----------|--------|
| ì£¼ë¬¸ ìƒì„± | `POST` | `/api/v2/orders` | ê³ ê° |
| ê²°ì œ ìš”ì²­ | `POST` | `/api/v2/orders/{order_id}/payment` | ê³ ê° |
| ì£¼ë¬¸ ì·¨ì†Œ | `POST` | `/api/v2/orders/{order_id}/cancellation` | ê³ ê° |
| ì£¼ë¬¸ ì ‘ìˆ˜ | `POST` | `/api/v2/orders/{order_id}/acceptance` | ë ˆìŠ¤í† ë‘ |
| ì£¼ë¬¸ ê±°ì ˆ | `POST` | `/api/v2/orders/{order_id}/rejection` | ë ˆìŠ¤í† ë‘ |
| ì¡°ë¦¬ ì™„ë£Œ | `POST` | `/api/v2/orders/{order_id}/preparation-complete` | ë ˆìŠ¤í† ë‘ |
| í”½ì—… ì™„ë£Œ | `POST` | `/api/v2/orders/{order_id}/pickup` | ë¼ì´ë” |
| ë°°ë‹¬ ì™„ë£Œ | `POST` | `/api/v2/orders/{order_id}/delivery` | ë¼ì´ë” |

**ì¥ì :**
- ê° í–‰ìœ„ë³„ë¡œ ëª…í™•í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì ìš© ê°€ëŠ¥
- ê¶Œí•œ ê²€ì¦ì´ ìš©ì´ (í–‰ìœ„ìë³„ ì—”ë“œí¬ì¸íŠ¸ ë¶„ë¦¬)
- í™•ì¥ì„± í–¥ìƒ (ìƒˆë¡œìš´ í–‰ìœ„ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ì˜í–¥ ìµœì†Œí™”)

---

### ì§ˆë¬¸ 2: ë©±ë“±ì„±(Idempotency) ë³´ì¥
- ê²°ì œ ì¬ì‹œë„ ì‹œ ì¤‘ë³µ ì²˜ë¦¬ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë©±ë“±ì„±ì„ ì–´ë–»ê²Œ ë³´ì¥í•  ê²ƒì¸ì§€ ì„¤ëª…í•˜ì‹œì˜¤. 
- í´ë¼ì´ì–¸íŠ¸ê°€ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì•ˆì „í•˜ê²Œ ì¬ì‹œë„í•  ìˆ˜ ìˆë„ë¡, `POST /api/v2/orders/{order_id}/payment`ì™€ ê°™ì€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì–´ë–»ê²Œ ìˆ˜ì •í•´ì•¼ í•˜ëŠ”ì§€ **Idempotency-Key í—¤ë”ë¥¼ í™œìš©í•˜ëŠ” í‘œì¤€ì ì¸ ë°©ë²•**ì„ í†µí•´ ê·¸ ìš”ì²­-ì‘ë‹µ íë¦„ê³¼ ì„œë²„ ì¸¡ì˜ ì²˜ë¦¬ ë¡œì§ì„ ìƒì„¸íˆ ê¸°ìˆ í•´ì•¼ í•©ë‹ˆë‹¤.

**[ë‹µë³€]**
> ë©±ë“±ì„±(Idempotency)ì´ë€ ë™ì¼í•œ ìš”ì²­ì„ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ë”ë¼ë„ ê²°ê³¼ê°€ í•œ ë²ˆ ì‹¤í–‰í•œ ê²ƒê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ë˜ëŠ” ì„±ì§ˆì…ë‹ˆë‹¤. HTTPì˜ GET, PUT, DELETE ë©”ì„œë“œëŠ” ì„¤ê³„ìƒ ë©±ë“±ì„±ì„ ê°€ì§€ì§€ë§Œ, POSTëŠ” ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¬¸ì œëŠ” ê²°ì œì™€ ê°™ì´ ë¶€ì‘ìš©(side effect)ì´ ìˆëŠ” ì‘ì—…ì—ì„œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œì…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ìš”ì²­ì´ ì„±ê³µí–ˆëŠ”ì§€ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ì–´ ì¬ì‹œë„ë¥¼ í•˜ê²Œ ë˜ê³ , ì´ë¡œ ì¸í•´ ì¤‘ë³µ ê²°ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” í‘œì¤€ì ì¸ ë°©ë²•ì´ **Idempotency-Key í—¤ë”**ì…ë‹ˆë‹¤. ë™ì‘ ì›ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ê²°ì œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ê³ ìœ í•œ Idempotency-Keyë¥¼ ìƒì„±í•˜ì—¬ í—¤ë”ì— í¬í•¨ì‹œí‚µë‹ˆë‹¤(ì˜ˆ: UUID). ì„œë²„ëŠ” ì´ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ì „ì— ë¨¼ì € í•´ë‹¹ í‚¤ê°€ ì´ë¯¸ ì²˜ë¦¬ëœ ì ì´ ìˆëŠ”ì§€ ì €ì¥ì†Œ(Redis, DB ë“±)ì—ì„œ í™•ì¸í•©ë‹ˆë‹¤. ë§Œì•½ í‚¤ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´, ì„œë²„ëŠ” ê²°ì œë¥¼ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ , ê·¸ í‚¤ì™€ í•¨ê»˜ ì‘ë‹µ ê²°ê³¼ë¥¼ ì €ì¥ì†Œì— ê¸°ë¡í•©ë‹ˆë‹¤. ë°˜ë©´ í‚¤ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´, ì´ê²ƒì€ ì¬ì‹œë„ ìš”ì²­ìœ¼ë¡œ ê°„ì£¼ë˜ì–´ ì‹¤ì œ ê²°ì œ ë¡œì§ì„ ì‹¤í–‰í•˜ì§€ ì•Šê³  **ì´ì „ì— ì €ì¥í•´ë‘” ì‘ë‹µì„ ê·¸ëŒ€ë¡œ ë°˜í™˜**í•©ë‹ˆë‹¤.

> ì´ íë¦„ì˜ í•µì‹¬ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì¼í•œ Idempotency-Keyë¡œ ì—¬ëŸ¬ ë²ˆ ìš”ì²­ì„ ë³´ë‚´ë”ë¼ë„ ì„œë²„ì—ì„œëŠ” ë‹¨ í•œ ë²ˆë§Œ ì‹¤ì œ ì²˜ë¦¬ê°€ ì´ë£¨ì–´ì§„ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ê°€ ì‘ë‹µì„ ë°›ì§€ ëª»í•˜ê³  ì¬ì‹œë„ë¥¼ í•˜ë”ë¼ë„, ì²« ë²ˆì§¸ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆë‹¤ë©´ ë‘ ë²ˆì§¸ ìš”ì²­ì€ ì €ì¥ëœ ì„±ê³µ ì‘ë‹µì„ ë°›ê²Œ ë˜ê³ , ì²« ë²ˆì§¸ ìš”ì²­ì´ ì‹¤íŒ¨í–ˆë‹¤ë©´ ë‘ ë²ˆì§¸ ìš”ì²­ì´ ìƒˆë¡œìš´ ì²˜ë¦¬ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.

> ì„œë²„ êµ¬í˜„ ì‹œ ê³ ë ¤í•´ì•¼ í•  ì ì€ Idempotency-Keyì˜ ìœ íš¨ ê¸°ê°„ ì„¤ì •(ë³´í†µ 24ì‹œê°„~7ì¼), ê·¸ë¦¬ê³  ìš”ì²­ì´ ì²˜ë¦¬ ì¤‘ì¼ ë•Œ ë™ì¼í•œ í‚¤ë¡œ ë‹¤ë¥¸ ìš”ì²­ì´ ë“¤ì–´ì˜¨ ê²½ìš°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë½(Lock) ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ êµ¬í˜„ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì•ˆì‹¬í•˜ê³  ì¬ì‹œë„ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ì¤‘ë³µ ê²°ì œë¡œ ì¸í•œ ê¸ˆìœµ ì‚¬ê³ ë¥¼ ì›ì²œì ìœ¼ë¡œ ì˜ˆë°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---
**ìš”ì²­-ì‘ë‹µ íë¦„:**

```http
POST /api/v2/orders/{order_id}/payment
Content-Type: application/json
Idempotency-Key: "unique-request-id-12345"

{
  "payment_method": "card",
  "amount": 25000
}
```

**ì„œë²„ ì¸¡ ì²˜ë¦¬ ë¡œì§:**

```
1. Idempotency-Key í™•ì¸
2. í‚¤ê°€ ì €ì¥ì†Œì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
   â”œâ”€ ì¡´ì¬í•¨ â†’ ì €ì¥ëœ ì‘ë‹µ ë°˜í™˜ (ì¬ì‹œë„ë¡œ ê°„ì£¼)
   â””â”€ ì¡´ì¬ ì•ˆí•¨ â†’ ìš”ì²­ ì²˜ë¦¬ ì§„í–‰
3. ìš”ì²­ ì²˜ë¦¬ ë° ê²°ê³¼ ì €ì¥
4. Idempotency-Keyì™€ í•¨ê»˜ ì‘ë‹µ ì €ì¥ì†Œì— ê¸°ë¡
5. ì‘ë‹µ ë°˜í™˜
```

**ì¬ì‹œë„ ì‹œ:**
- ë™ì¼í•œ `Idempotency-Key`ë¡œ ìš”ì²­
- ì„œë²„ê°€ ì €ì¥ëœ ì‘ë‹µ ë°˜í™˜
- ì¤‘ë³µ ê²°ì œ ë°©ì§€

**ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (V2 API):**
```
=== ë©±ë“±ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘ (Idempotency) ===
í…ŒìŠ¤íŠ¸ìš© ì£¼ë¬¸ ìƒì„± ì™„ë£Œ: ID 13
ì´ˆê¸° ìƒíƒœ: pending_payment
ìƒì„±ëœ Idempotency-Key: bb9e65b7-5e28-46d2-a25c-33fa1d89b5fb

[ìš”ì²­ 1] ì²« ë²ˆì§¸ ê²°ì œ ìš”ì²­ ì „ì†¡...
[ê²°ê³¼ 1] ì„±ê³µ (200 OK). ìƒíƒœ: pending_acceptance

[ìš”ì²­ 2] ë‘ ë²ˆì§¸ ê²°ì œ ìš”ì²­ ì „ì†¡ (ë™ì¼ í‚¤)...
[ê²°ê³¼ 2] ì„±ê³µ (200 OK).
[ê²€ì¦] ì‘ë‹µ ë³¸ë¬¸ì´ ì²« ë²ˆì§¸ì™€ ì™„ì „íˆ ë™ì¼í•¨. (ì‹œê°„, ìƒíƒœ ë“±)
[ê²€ì¦] Version ë³€í™” ì—†ìŒ (2 -> 2). ë©±ë“±ì„± ë™ì‘ í™•ì¸!
```
>  **ì¤‘ë³µ ê²°ì œ ë°©ì§€**: ë™ì¼í•œ í‚¤ë¡œ ì¬ìš”ì²­í•´ë„ ì‹¤ì œ ì²˜ë¦¬ëŠ” 1ë²ˆë§Œ ìˆ˜í–‰ë¨.
> í…ŒìŠ¤íŠ¸ ì‹¤í–‰: `python black_BOX_test.py`

---

### ì§ˆë¬¸ 3: ë‚™ê´€ì  ë½(Optimistic Locking) êµ¬í˜„
- ê³ ê°ì˜ 'ì£¼ë¬¸ ì·¨ì†Œ'ì™€ ë ˆìŠ¤í† ë‘ì˜ 'ì£¼ë¬¸ ì ‘ìˆ˜'ê°€ ì¶©ëŒí•˜ëŠ” ê²ƒê³¼ ê°™ì€ **ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë‚™ê´€ì  ë½(Optimistic Locking) ì „ëµ**ì„ API ìˆ˜ì¤€ì—ì„œ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ì§€ ì„¤ëª…í•˜ì‹œì˜¤. 
- HTTPì˜ **ETagì™€ If-Match ì¡°ê±´ë¶€ ìš”ì²­ í—¤ë”**ë¥¼ ì‚¬ìš©í•˜ì—¬, í´ë¼ì´ì–¸íŠ¸ê°€ í•­ìƒ ë¦¬ì†ŒìŠ¤ì˜ ìµœì‹  ë²„ì „ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒíƒœ ë³€ê²½ì„ ì‹œë„í•˜ë„ë¡ ë³´ì¥í•˜ëŠ” ì „ì²´ì ì¸ ê³¼ì •ì„ ì„¤ëª…í•´ì•¼ í•©ë‹ˆë‹¤. 
- ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ê°€ ì˜¤ë˜ëœ ë²„ì „ì˜ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­í–ˆì„ ë•Œ, ì„œë²„ê°€ **412 Precondition Failed** ì‘ë‹µì„ ë°˜í™˜í•˜ì—¬ ì¶©ëŒì„ ë°©ì§€í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í¬í•¨í•˜ì—¬ ë…¼í•˜ì‹œì˜¤.

**[ë‹µë³€]**

> ë™ì‹œì„± ë¬¸ì œëŠ” ì—¬ëŸ¬ í–‰ìœ„ìê°€ ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ê±°ì˜ ë™ì‹œì— ë³€ê²½í•˜ë ¤ í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. QuickEatsì˜ ê²½ìš°, ê³ ê°ì´ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ë ¤ëŠ” ìˆœê°„ ë ˆìŠ¤í† ë‘ì´ ì£¼ë¬¸ì„ ì ‘ìˆ˜í•˜ëŠ” ìƒí™©ì´ ëŒ€í‘œì ì…ë‹ˆë‹¤. ë‘ ìš”ì²­ì´ ëª¨ë‘ "ì£¼ë¬¸ ì ‘ìˆ˜ ëŒ€ê¸°ì¤‘(pending_acceptance)" ìƒíƒœì—ì„œ ì¶œë°œí•˜ì§€ë§Œ, ê²°ê³¼ì ìœ¼ë¡œ í•˜ë‚˜ë§Œ ìœ íš¨í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ í¬ê²Œ ë¹„ê´€ì  ë½(Pessimistic Locking)ê³¼ ë‚™ê´€ì  ë½(Optimistic Locking)ì´ ìˆëŠ”ë°, ì›¹ API í™˜ê²½ì—ì„œëŠ” ë‚™ê´€ì  ë½ì´ ë” ì í•©í•©ë‹ˆë‹¤.

> ë‚™ê´€ì  ë½ì˜ ì² í•™ì€ "ì¶©ëŒì€ ë“œë¬¼ê²Œ ë°œìƒí•œë‹¤"ê³  ê°€ì •í•˜ê³ , ì¶©ëŒì´ ë°œìƒí–ˆì„ ë•Œ ì´ë¥¼ ê°ì§€í•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. HTTP í‘œì¤€ì—ì„œëŠ” ì´ë¥¼ ìœ„í•´ **ETag(Entity Tag)**ì™€ **If-Match** í—¤ë”ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ETagëŠ” ë¦¬ì†ŒìŠ¤ì˜ íŠ¹ì • ë²„ì „ì„ ì‹ë³„í•˜ëŠ” ê³ ìœ í•œ ê°’ìœ¼ë¡œ, ë¦¬ì†ŒìŠ¤ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í•¨ê»˜ ê°±ì‹ ë©ë‹ˆë‹¤.

> ë™ì‘ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë¨¼ì € í´ë¼ì´ì–¸íŠ¸ê°€ ì£¼ë¬¸ ì •ë³´ë¥¼ ì¡°íšŒí•˜ë©´(`GET /api/v2/orders/{order_id}`), ì„œë²„ëŠ” ì‘ë‹µ í—¤ë”ì— í˜„ì¬ ë¦¬ì†ŒìŠ¤ì˜ ETag ê°’(ì˜ˆ: `"abc123"`)ì„ í¬í•¨í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ì´í›„ ìƒíƒœ ë³€ê²½ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, ìì‹ ì´ ë°›ì•˜ë˜ ETag ê°’ì„ `If-Match` í—¤ë”ì— ë‹´ì•„ ì „ì†¡í•©ë‹ˆë‹¤(ì˜ˆ: `If-Match: "abc123"`). ì„œë²„ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ì „ì— ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ í˜„ì¬ ë¦¬ì†ŒìŠ¤ì˜ ë²„ì „ê³¼ If-Match í—¤ë”ì˜ ê°’ì„ ë¹„êµí•©ë‹ˆë‹¤. ë‘ ê°’ì´ ì¼ì¹˜í•˜ë©´ ìš”ì²­ì„ ì •ìƒ ì²˜ë¦¬í•˜ê³  ìƒˆë¡œìš´ ETagë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤. ë§Œì•½ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°íšŒí•œ ì´í›„ ë‹¤ë¥¸ ëˆ„êµ°ê°€ê°€ ì´ë¯¸ ë³€ê²½í–ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ë¯€ë¡œ, ì„œë²„ëŠ” **412 Precondition Failed** ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤.

> êµ¬ì²´ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤. ê³ ê° ì•±ê³¼ ë ˆìŠ¤í† ë‘ ì•±ì´ ê±°ì˜ ë™ì‹œì— ì£¼ë¬¸ ì •ë³´ë¥¼ ì¡°íšŒí•˜ì—¬ ë‘˜ ë‹¤ ETag `"abc123"`ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. ë ˆìŠ¤í† ë‘ì´ ë¨¼ì € ì£¼ë¬¸ ì ‘ìˆ˜ ìš”ì²­ì„ ë³´ë‚´ë©´, ì„œë²„ëŠ” ì´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ETagë¥¼ `"def456"`ìœ¼ë¡œ ê°±ì‹ í•©ë‹ˆë‹¤. ì ì‹œ í›„ ê³ ê°ì´ ì·¨ì†Œ ìš”ì²­ì„ `If-Match: "abc123"`ê³¼ í•¨ê»˜ ë³´ë‚´ë©´, ì„œë²„ëŠ” í˜„ì¬ ETag `"def456"`ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŒì„ í™•ì¸í•˜ê³  412 ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤. ê³ ê° ì•±ì€ ì´ ì‘ë‹µì„ ë°›ê³  ì‚¬ìš©ìì—ê²Œ "ì´ë¯¸ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."ë¼ëŠ” ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì´ ë°©ì‹ì€ ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì¤€ì˜ ë½ì„ ì¥ì‹œê°„ ìœ ì§€í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì‹œìŠ¤í…œ ì²˜ë¦¬ëŸ‰ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ì ìœ¼ë©°, HTTP í‘œì¤€ì„ í™œìš©í•˜ë¯€ë¡œ RESTfulí•œ ì„¤ê³„ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

**ì „ì²´ íë¦„:**

#### Step 1: ë¦¬ì†ŒìŠ¤ ì¡°íšŒ (ETag ìˆ˜ì‹ )
```http
GET /api/v2/orders/{order_id}

HTTP/1.1 200 OK
ETag: "abc123xyz"
Content-Type: application/json

{
  "id": "order-123",
  "status": "pending_acceptance",
  "version": 5
}
```

#### Step 2: ìƒíƒœ ë³€ê²½ ìš”ì²­ (If-Match í¬í•¨)
```http
POST /api/v2/orders/{order_id}/cancellation
If-Match: "abc123xyz"
Content-Type: application/json

{
  "reason": "ê³ ê° ë³€ì‹¬"
}
```

#### ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤:
```http
HTTP/1.1 200 OK
ETag: "def456uvw"

{
  "id": "order-123",
  "status": "cancelled"
}
```

#### ì¶©ëŒ ì‹œë‚˜ë¦¬ì˜¤ (412 Precondition Failed):
```http
HTTP/1.1 412 Precondition Failed
Content-Type: application/json

{
  "error": "conflict",
  "message": "ë¦¬ì†ŒìŠ¤ê°€ ì´ë¯¸ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ìµœì‹  ë²„ì „ì„ ì¡°íšŒ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.",
  "current_status": "preparing"
}
```

**ì¶©ëŒ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜:**
- ê³ ê° ì·¨ì†Œ ìš”ì²­ê³¼ ë ˆìŠ¤í† ë‘ ì ‘ìˆ˜ ìš”ì²­ì´ ë™ì‹œì— ì˜¤ë©´
- ë¨¼ì € ì²˜ë¦¬ëœ ìš”ì²­ì´ ETag ê°±ì‹ 
- ë‚˜ì¤‘ì— ì²˜ë¦¬ë˜ëŠ” ìš”ì²­ì€ If-Match ë¶ˆì¼ì¹˜ë¡œ 412 ë°˜í™˜

---

### ì§ˆë¬¸ 4: N+1 ë¬¸ì œ í•´ê²° ì „ëµ
í´ë¼ì´ì–¸íŠ¸ ì•±ì˜ N+1 ì¡°íšŒ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ **ë‘ ê°€ì§€ ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„° ì œê³µ ì „ëµ**ì„ ì œì‹œí•˜ê³  ë¹„êµí•˜ì‹œì˜¤.
- **ì²« ë²ˆì§¸**: RESTful APIì˜ ìœ ì—°ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ê´€ë ¨ ë¦¬ì†ŒìŠ¤ë¥¼ í•¨ê»˜ í¬í•¨í•˜ì—¬ ì „ë‹¬í•˜ëŠ” **'ì»´íŒŒìš´ë“œ ë„íë¨¼íŠ¸(Compound Document)' ë˜ëŠ” 'ì‚¬ì´ë“œë¡œë”©(Side-loading)'** ë°©ì‹ì„ `?include=restaurant,rider`ì™€ ê°™ì€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•´ì•¼ í•©ë‹ˆë‹¤.
- **ë‘ ë²ˆì§¸**: ëŒ€ì•ˆì ì¸ ì•„í‚¤í…ì²˜ë¡œì„œ **GraphQL**ì„ ë„ì…í•œë‹¤ë©´ ì´ ë¬¸ì œê°€ ì–´ë–»ê²Œ ë” ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°ë  ìˆ˜ ìˆëŠ”ì§€, í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•œ ë°ì´í„°ì˜ êµ¬ì¡°ë¥¼ ì§ì ‘ ì •ì˜í•˜ëŠ” GraphQLì˜ íŠ¹ì§•ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë‘ ë°©ì‹ì˜ ì¥ë‹¨ì ì„ ê¸°ìˆ í•˜ì‹œì˜¤.

**[ë‹µë³€]**

> N+1 ë¬¸ì œëŠ” REST APIì—ì„œ í”íˆ ë°œìƒí•˜ëŠ” ì„±ëŠ¥ ì´ìŠˆì…ë‹ˆë‹¤. ì£¼ë¬¸ ëª©ë¡ í™”ë©´ì—ì„œ Nê°œì˜ ì£¼ë¬¸ê³¼ í•¨ê»˜ ê° ì£¼ë¬¸ì˜ ë ˆìŠ¤í† ë‘ ì´ë¦„, ë¼ì´ë” ìœ„ì¹˜ë¥¼ ë³´ì—¬ì¤˜ì•¼ í•œë‹¤ë©´, ê¸°ì¡´ V1 APIë¡œëŠ” 1ë²ˆ(ì£¼ë¬¸ ëª©ë¡) + Në²ˆ(ë ˆìŠ¤í† ë‘ ì¡°íšŒ) + Në²ˆ(ë¼ì´ë” ì¡°íšŒ) = 2N+1ë²ˆì˜ API í˜¸ì¶œì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì„ ëˆ„ì ì‹œí‚¤ê³  ì„œë²„ ë¶€í•˜ë¥¼ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.

> **ì²« ë²ˆì§¸ í•´ê²°ì±…ì€ ì‚¬ì´ë“œë¡œë”©(Side-loading) ë°©ì‹**ì…ë‹ˆë‹¤. ì´ ë°©ì‹ì€ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ í•¨ê»˜ ì¡°íšŒí•  ê´€ë ¨ ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `GET /api/v2/orders?include=restaurant,rider`ë¡œ ìš”ì²­í•˜ë©´, ì„œë²„ëŠ” ì£¼ë¬¸ ë°ì´í„°ì™€ í•¨ê»˜ ê´€ë ¨ëœ ë ˆìŠ¤í† ë‘ê³¼ ë¼ì´ë” ì •ë³´ë¥¼ ì‘ë‹µì— í¬í•¨ì‹œí‚µë‹ˆë‹¤. ì‘ë‹µ êµ¬ì¡°ëŠ” ê¸°ë³¸ ë°ì´í„°(`data`)ì™€ í¬í•¨ëœ ë¦¬ì†ŒìŠ¤(`included`)ë¡œ ë¶„ë¦¬ë©ë‹ˆë‹¤. ì´ ë°©ì‹ì˜ ì¥ì ì€ ê¸°ì¡´ REST ì•„í‚¤í…ì²˜ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì ì§„ì ìœ¼ë¡œ ë„ì…í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë˜í•œ í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•  ë•Œë§Œ ê´€ë ¨ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ ì—°í•©ë‹ˆë‹¤. ë‹¨ì ì€ ì„œë²„ì—ì„œ ì§€ì›í•˜ëŠ” include ì˜µì…˜ì˜ ì¡°í•©ì— ì œí•œì´ ìˆì„ ìˆ˜ ìˆê³ , ë¶ˆí•„ìš”í•œ í•„ë“œê¹Œì§€ ëª¨ë‘ ì „ì†¡ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

> **ë‘ ë²ˆì§¸ í•´ê²°ì±…ì€ GraphQL ë„ì…**ì…ë‹ˆë‹¤. GraphQLì€ í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•œ ë°ì´í„°ì˜ êµ¬ì¡°ë¥¼ ì§ì ‘ ì¿¼ë¦¬ë¡œ ì •ì˜í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” "ì£¼ë¬¸ì˜ id, status, ê·¸ë¦¬ê³  ë ˆìŠ¤í† ë‘ì˜ name, ë¼ì´ë”ì˜ nameê³¼ currentLocationë§Œ í•„ìš”í•˜ë‹¤"ê³  ëª…ì‹œì ìœ¼ë¡œ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë²„ëŠ” ì •í™•íˆ ìš”ì²­ëœ ë°ì´í„°ë§Œ ë°˜í™˜í•˜ë¯€ë¡œ, ê³¼ë‹¤ ì „ì†¡(Over-fetching)ê³¼ ë¶€ì¡± ì „ì†¡(Under-fetching) ë¬¸ì œê°€ ë³¸ì§ˆì ìœ¼ë¡œ í•´ê²°ë©ë‹ˆë‹¤.

> ë‘ ë°©ì‹ì„ ë¹„êµí•˜ë©´, ì‚¬ì´ë“œë¡œë”©ì€ ê¸°ì¡´ REST ì¸í”„ë¼ë¥¼ í™œìš©í•  ìˆ˜ ìˆì–´ ë„ì… ë¹„ìš©ì´ ë‚®ì§€ë§Œ ìœ ì—°ì„±ì— í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤. GraphQLì€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ìµœëŒ€ì˜ ìœ ì—°ì„±ì„ ì œê³µí•˜ì§€ë§Œ, ìƒˆë¡œìš´ ìŠ¤í‚¤ë§ˆ ì„¤ê³„, í•™ìŠµ ë¹„ìš©, ìºì‹± ì „ëµ ì¬ê³ ë ¤ ë“± ë„ì… ì¥ë²½ì´ ë†’ìŠµë‹ˆë‹¤. ë˜í•œ GraphQLì€ ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸ë¡œ ë™ì‘í•˜ë¯€ë¡œ HTTP ìºì‹±ì´ ì–´ë µê³ , ë³µì¡í•œ ì¿¼ë¦¬ë¡œ ì¸í•œ ì„œë²„ ë¶€í•˜ë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ ì¿¼ë¦¬ ë³µì¡ë„ ë¶„ì„ ê¸°ëŠ¥ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì‹¤ë¬´ì—ì„œëŠ” ì‹œìŠ¤í…œì˜ ë³µì¡ë„ì™€ íŒ€ì˜ ì—­ëŸ‰ì— ë”°ë¼ ì„ íƒí•©ë‹ˆë‹¤. ìƒëŒ€ì ìœ¼ë¡œ ë‹¨ìˆœí•œ ê´€ê³„ë¥¼ ê°€ì§„ ì‹œìŠ¤í…œì´ë‚˜ ì´ë¯¸ RESTì— ìµìˆ™í•œ íŒ€ì´ë¼ë©´ ì‚¬ì´ë“œë¡œë”©ì´ í˜„ì‹¤ì ì¸ ì„ íƒì´ê³ , ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸(ì›¹, ëª¨ë°”ì¼, íƒœë¸”ë¦¿)ê°€ ê°ê¸° ë‹¤ë¥¸ ë°ì´í„°ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ë³µì¡í•œ ì‹œìŠ¤í…œì´ë¼ë©´ GraphQLì´ ì¥ê¸°ì ìœ¼ë¡œ ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

#### ë°©ë²• 1: ì»´íŒŒìš´ë“œ ë„íë¨¼íŠ¸ / ì‚¬ì´ë“œë¡œë”© (Side-loading)

**ìš”ì²­:**
```http
GET /api/v2/orders?include=restaurant,rider
```

**ì‘ë‹µ:**
```json
{
  "data": [
    {
      "id": "order-123",
      "status": "in_transit",
      "restaurant_id": "rest-456",
      "rider_id": "rider-789"
    }
  ],
  "included": {
    "restaurants": [
      {
        "id": "rest-456",
        "name": "ë§›ìˆëŠ” ì¹˜í‚¨ì§‘",
        "address": "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬..."
      }
    ],
    "riders": [
      {
        "id": "rider-789",
        "name": "ê¹€ë°°ë‹¬",
        "current_location": { "lat": 37.5, "lng": 127.0 }
      }
    ]
  }
}
```

| ì¥ì  | ë‹¨ì  |
|------|------|
| RESTful ì›ì¹™ ìœ ì§€ | ì„œë²„ì—ì„œ ì§€ì›í•˜ëŠ” ì¡°í•©ë§Œ ê°€ëŠ¥ |
| ê¸°ì¡´ ì¸í”„ë¼ í™œìš© ê°€ëŠ¥ | ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŒ |
| êµ¬í˜„ ìƒëŒ€ì ìœ¼ë¡œ ë‹¨ìˆœ | ê³¼ë‹¤ ë°ì´í„° ì „ì†¡(Over-fetching) ê°€ëŠ¥ |

---

#### ë°©ë²• 2: GraphQL ë„ì…

**ìš”ì²­:**
```graphql
query {
  orders {
    id
    status
    restaurant {
      name
      address
    }
    rider {
      name
      currentLocation {
        lat
        lng
      }
    }
  }
}
```

**ì‘ë‹µ:**
```json
{
  "data": {
    "orders": [
      {
        "id": "order-123",
        "status": "in_transit",
        "restaurant": {
          "name": "ë§›ìˆëŠ” ì¹˜í‚¨ì§‘",
          "address": "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬..."
        },
        "rider": {
          "name": "ê¹€ë°°ë‹¬",
          "currentLocation": { "lat": 37.5, "lng": 127.0 }
        }
      }
    ]
  }
}
```

| ì¥ì  | ë‹¨ì  |
|------|------|
| í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•œ ë°ì´í„° ì§ì ‘ ì •ì˜ | í•™ìŠµ ê³¡ì„  ì¡´ì¬ |
| ê³¼ë‹¤/ë¶€ì¡± ë°ì´í„° ì „ì†¡ ë¬¸ì œ ê·¼ë³¸ í•´ê²° | ìºì‹± ë³µì¡ë„ ì¦ê°€ |
| ë‹¨ì¼ ìš”ì²­ìœ¼ë¡œ ë³µì¡í•œ ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥ | ì„œë²„ ë³µì¡ë„ ì¦ê°€ |
| ê°•ë ¥í•œ íƒ€ì… ì‹œìŠ¤í…œ | ê¸°ì¡´ REST ì¸í”„ë¼ ëŒ€ì²´ í•„ìš” |

---

### ì§ˆë¬¸ 5: API ë²„ì „ ê´€ë¦¬ ì „ëµ
- ê¸°ì¡´ V1 APIë¥¼ ì‚¬ìš©í•˜ëŠ” êµ¬ë²„ì „ ì•± ì‚¬ìš©ìë“¤ì„ ì¤‘ë‹¨ ì—†ì´ ì§€ì›í•˜ë©´ì„œ, ìƒˆë¡œìš´ V2 APIë¥¼ ì•ˆì „í•˜ê²Œ ì¶œì‹œí•˜ê¸° ìœ„í•œ **API ë²„ì „ ê´€ë¦¬ ì „ëµ**ì„ ì œì‹œí•˜ì‹œì˜¤. 
- ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” **URI ê²½ë¡œ ê¸°ë°˜ ë²„ì „ ê´€ë¦¬**(ì˜ˆ: `/api/v2/...`) ë°©ì‹ì˜ ì¥ì ì„ ì„¤ëª…í•˜ê³ , ì´ë¥¼ Djangoì™€ ê°™ì€ ì›¹ í”„ë ˆì„ì›Œí¬ì—ì„œ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ”ì§€ ê¸°ìˆ í•´ì•¼ í•©ë‹ˆë‹¤.

**[ë‹µë³€]**

> API ë²„ì „ ê´€ë¦¬ëŠ” ê¸°ì¡´ ì‚¬ìš©ìì˜ ì„œë¹„ìŠ¤ ì—°ì†ì„±ì„ ë³´ì¥í•˜ë©´ì„œ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì•ˆì „í•˜ê²Œ ë°°í¬í•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤. API ë²„ì „ ê´€ë¦¬ì—ëŠ” ì—¬ëŸ¬ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. URI ê²½ë¡œì— ë²„ì „ì„ í¬í•¨í•˜ëŠ” ë°©ì‹(`/api/v1/`, `/api/v2/`), ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë°©ì‹(`?version=2`), ì»¤ìŠ¤í…€ í—¤ë” ë°©ì‹(`X-API-Version: 2`), Accept í—¤ë”ì˜ ë¯¸ë””ì–´ íƒ€ì… ë°©ì‹(`Accept: application/vnd.quickeats.v2+json`) ë“±ì´ ìˆìŠµë‹ˆë‹¤.

> ì´ ì¤‘ **URI ê²½ë¡œ ê¸°ë°˜ ë²„ì „ ê´€ë¦¬**ê°€ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì´ìœ ëŠ” ëª…í™•í•©ë‹ˆë‹¤. ì²«ì§¸, ì§ê´€ì ì´ê³  ê°€ì‹œì„±ì´ ë†’ìŠµë‹ˆë‹¤. URLë§Œ ë³´ê³ ë„ ì–´ë–¤ ë²„ì „ì˜ APIë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ ì¦‰ì‹œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‘˜ì§¸, ë¸Œë¼ìš°ì €ì—ì„œ ì‰½ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³„ë„ì˜ í—¤ë” ì„¤ì • ì—†ì´ ì£¼ì†Œì°½ì— ì§ì ‘ ì…ë ¥í•˜ì—¬ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì…‹ì§¸, ìºì‹± ì •ì±…ì„ ë²„ì „ë³„ë¡œ ë…ë¦½ì ìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CDNì´ë‚˜ í”„ë¡ì‹œ ì„œë²„ì—ì„œ URL ê¸°ë°˜ ìºì‹±ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ë„·ì§¸, ë¡œë“œ ë°¸ëŸ°ì„œë‚˜ API ê²Œì´íŠ¸ì›¨ì´ì—ì„œ ë²„ì „ë³„ ë¼ìš°íŒ…ì„ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> Djangoì—ì„œ ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. ë²„ì „ë³„ë¡œ ë³„ë„ì˜ ì•± ë˜ëŠ” ëª¨ë“ˆì„ ë§Œë“¤ê³ , ìµœìƒìœ„ URL ì„¤ì •ì—ì„œ ê° ë²„ì „ì— í•´ë‹¹í•˜ëŠ” ê²½ë¡œë¥¼ ë¼ìš°íŒ…í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `api/v1/` ê²½ë¡œëŠ” v1 ëª¨ë“ˆì˜ URL ì„¤ì •ìœ¼ë¡œ, `api/v2/` ê²½ë¡œëŠ” v2 ëª¨ë“ˆì˜ URL ì„¤ì •ìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ V1ê³¼ V2ì˜ ì½”ë“œê°€ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´, í•œ ë²„ì „ì˜ ìˆ˜ì •ì´ ë‹¤ë¥¸ ë²„ì „ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.

> ë²„ì „ ì „í™˜ì„ ìœ„í•œ ì‹¤ì œ ìš´ì˜ ì „ëµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ë¨¼ì € V2 APIë¥¼ ê°œë°œí•˜ê³  ì¶©ë¶„íˆ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. ê·¸ í›„ V1ê³¼ V2ë¥¼ ë™ì‹œì— ìš´ì˜í•˜ëŠ” ë³‘ë ¬ ìš´ì˜ ê¸°ê°„ì„ ê°€ì§‘ë‹ˆë‹¤. ì´ ê¸°ê°„ ë™ì•ˆ ì‹ ê·œ ì•± ë²„ì „ì€ V2ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ê³ , êµ¬ë²„ì „ ì•±ì€ ê³„ì† V1ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. V1 ì‚¬ìš©ë¥ ì„ ëª¨ë‹ˆí„°ë§í•˜ë©´ì„œ ì¶©ë¶„íˆ ê°ì†Œí•˜ë©´, V1 Deprecation ê³µì§€ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤. ë³´í†µ 6ê°œì›”ì—ì„œ 1ë…„ ì •ë„ì˜ ìœ ì˜ˆ ê¸°ê°„ì„ ë‘ê³ , ì´í›„ V1 ì„œë¹„ìŠ¤ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ V1 ìš”ì²­ì— ëŒ€í•´ ê²½ê³  í—¤ë”(`Deprecation` ë˜ëŠ” `Sunset`)ë¥¼ í¬í•¨ì‹œì¼œ í´ë¼ì´ì–¸íŠ¸ ê°œë°œìì—ê²Œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ê²°ë¡ ì ìœ¼ë¡œ, URI ê²½ë¡œ ê¸°ë°˜ ë²„ì „ ê´€ë¦¬ëŠ” êµ¬í˜„ì´ ê°„ë‹¨í•˜ê³  ìš´ì˜ì´ ëª…í™•í•˜ì—¬ ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì—ì„œ ê¶Œì¥ë˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
---
#### URI ê²½ë¡œ ê¸°ë°˜ ë²„ì „ ê´€ë¦¬

```
/api/v1/orders  â†’  ê¸°ì¡´ ì‚¬ìš©ì ì§€ì›
/api/v2/orders  â†’  ìƒˆë¡œìš´ ê¸°ëŠ¥
```

**ì¥ì :**
- ëª…í™•í•˜ê³  ì§ê´€ì 
- ë¸Œë¼ìš°ì €ì—ì„œ ì‰½ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- ìºì‹± ì •ì±… ë²„ì „ë³„ ë…ë¦½ ì ìš© ê°€ëŠ¥
- ë¡œë“œ ë°¸ëŸ°ì„œì—ì„œ ë²„ì „ë³„ ë¼ìš°íŒ… ìš©ì´


**urls.py (orders/urls.py):**
```python
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import OrderV1ViewSet

router = DefaultRouter()
router.register(r'orders', OrderV1ViewSet)

urlpatterns = [
    path('v1/', include(router.urls)),           # /api/v1/orders/
    path('v2/', include('orders.api.v2.urls')),  # /api/v2/orders/
]
```

**ë²„ì „ ì „í™˜ ì „ëµ:**
1. V2 API ê°œë°œ ë° í…ŒìŠ¤íŠ¸
2. V1ê³¼ V2 ë™ì‹œ ìš´ì˜ (ë³‘ë ¬ ìš´ì˜ ê¸°ê°„)
3. ì‹ ê·œ ì•± ë²„ì „ì—ì„œ V2 ì‚¬ìš©
4. V1 ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§
5. V1 Deprecation ê³µì§€
6. ì¶©ë¶„í•œ ìœ ì˜ˆ ê¸°ê°„ í›„ V1 ì¢…ë£Œ
---




## ğŸ“– í”„ë¡œì íŠ¸ êµ¬ì¡° & êµ¬í˜„ 

### ğŸ”¹ í•µì‹¬ í–‰ìœ„ì (Actors)
| í–‰ìœ„ì | ì—­í•  |
|--------|------|
| ê³ ê° (Customer) | ì£¼ë¬¸ ìƒì„±, ê²°ì œ, ì·¨ì†Œ |
| ë ˆìŠ¤í† ë‘ (Restaurant) | ì£¼ë¬¸ ì ‘ìˆ˜/ê±°ì ˆ, ì¡°ë¦¬ |
| ë¼ì´ë” (Rider) | í”½ì—…, ë°°ë‹¬ |

### ğŸ”¹ ì£¼ë¬¸(Order)ì˜ í•µì‹¬ ìƒëª…ì£¼ê¸°

```mermaid
stateDiagram-v2
    [*] --> pending_payment: ì£¼ë¬¸ ìƒì„±
    pending_payment --> payment_failed: ê²°ì œ ì‹¤íŒ¨
    pending_payment --> pending_acceptance: ê²°ì œ ì„±ê³µ
    pending_payment --> cancelled: ê²°ì œ ì „ ì·¨ì†Œ
    pending_acceptance --> rejected: ì£¼ë¬¸ ê±°ì ˆ
    pending_acceptance --> cancelled: ì ‘ìˆ˜ ì „ ì·¨ì†Œ
    pending_acceptance --> preparing: ì£¼ë¬¸ ì ‘ìˆ˜
    preparing --> ready_for_pickup: ì¡°ë¦¬ ì™„ë£Œ
    ready_for_pickup --> in_transit: í”½ì—… ì™„ë£Œ
    in_transit --> delivered: ë°°ë‹¬ ì™„ë£Œ
    delivered --> [*]
    cancelled --> [*]
    rejected --> [*]
    payment_failed --> [*]
```

| ìƒíƒœ | ì„¤ëª… | ì „ì´ ê°€ëŠ¥ í–‰ìœ„ |
|------|------|---------------|
| `pending_payment` | ê²°ì œ ëŒ€ê¸°ì¤‘ | payment, cancellation |
| `payment_failed` | ê²°ì œ ì‹¤íŒ¨ | (ì¢…ë£Œ ìƒíƒœ) |
| `pending_acceptance` | ì£¼ë¬¸ ì ‘ìˆ˜ ëŒ€ê¸°ì¤‘ | acceptance, rejection, cancellation |
| `rejected` | ì£¼ë¬¸ ê±°ì ˆë¨ | (ì¢…ë£Œ ìƒíƒœ) |
| `cancelled` | ì£¼ë¬¸ ì·¨ì†Œë¨ | (ì¢…ë£Œ ìƒíƒœ) |
| `preparing` | ì¡°ë¦¬ì¤‘ | preparation-complete |
| `ready_for_pickup` | í”½ì—… ëŒ€ê¸°ì¤‘ | pickup |
| `in_transit` | ë°°ë‹¬ì¤‘ | delivery |
| `delivered` | ë°°ë‹¬ ì™„ë£Œ | (ì¢…ë£Œ ìƒíƒœ) |

---

### ğŸ”¹ ì‹¤í–‰ ê°€ì´ë“œ

```bash
# 1. ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv venv
venv\Scripts\activate  # Windows
# 2. íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt
# 3. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
python manage.py migrate
# 4. ê´€ë¦¬ì ê³„ì • ìƒì„±
python manage.py createsuperuser
# 5. ì„œë²„ ì‹¤í–‰
python manage.py runserver
====== TEST CODE ì‹¤í–‰ ======
# 6. Race Condition í…ŒìŠ¤íŠ¸ (ë³„ë„ í„°ë¯¸ë„)
python black_BOX_test_v1.0.py
# 7. ë©±ë“±ì„± í…ŒìŠ¤íŠ¸
python black_BOX_test.py
# 8. V2 API í…ŒìŠ¤íŠ¸
python manage.py test orders.tests_v2
# 9. N+1 ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
python manage.py test orders.tests_nplus1
============================================
http://127.0.0.1:8000/api/v1/orders/    ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ / ìƒˆ ì£¼ë¬¸ ìƒì„±
http://127.0.0.1:8000/api/v1/orders/n/  në²ˆ ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ / ìˆ˜ì •
http://127.0.0.1:8000/api/v2/orders/    ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ / ìƒˆ ì£¼ë¬¸ ìƒì„±
http://127.0.0.1:8000/api/v2/orders/n/  në²ˆ ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ / ìˆ˜ì •
http://127.0.0.1:8000/admin/            ê´€ë¦¬ì í˜ì´ì§€
```

### ğŸ”¹ ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸

| ë²„ì „ | ì—”ë“œí¬ì¸íŠ¸ | ì„¤ëª… |
|------|-----------|------|
| V1 | `GET /api/v1/orders/` | ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ |
| V1 | `PUT /api/v1/orders/{id}/` | ìƒíƒœ ë³€ê²½ (ë¬¸ì œ ìˆìŒ) |
| V2 | `GET /api/v2/orders/` | ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ |
| V2 | `POST /api/v2/orders/{id}/payment/` | ê²°ì œ ì²˜ë¦¬ |
| V2 | `POST /api/v2/orders/{id}/cancellation/` | ì£¼ë¬¸ ì·¨ì†Œ |
| V2 | `POST /api/v2/orders/{id}/acceptance/` | ì£¼ë¬¸ ì ‘ìˆ˜ |
| - | `/admin/` | Django ê´€ë¦¬ì í˜ì´ì§€ |



```
B2_baedal/
â”œâ”€â”€ manage.py                 # Django ê´€ë¦¬ ëª…ë ¹ì–´
â”œâ”€â”€ requirements.txt          # ì˜ì¡´ì„± íŒ¨í‚¤ì§€
â”œâ”€â”€ black_BOX_test_v1.0.py    # ğŸ”ºRace Condition í…ŒìŠ¤íŠ¸
â”œâ”€â”€ README.md                 # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â”‚
â”œâ”€â”€ quickeats/                # í”„ë¡œì íŠ¸ ì„¤ì •
â”‚   â”œâ”€â”€ settings.py           # Django ì„¤ì • (DB, ì•± ë“±)
â”‚   â”œâ”€â”€ urls.py               # ë©”ì¸ URL ë¼ìš°í„°
â”‚   â””â”€â”€ wsgi.py
â”‚
â””â”€â”€ orders/                   # ì£¼ë¬¸ ì•± (í•µì‹¬)
    â”œâ”€â”€ models.py             # Order ëª¨ë¸ + ìƒíƒœ ì •ì˜
    â”œâ”€â”€ views.py              # V1 ViewSet (ë¬¸ì œ ìˆëŠ” ë²„ì „)
    â”œâ”€â”€ urls.py               # URL ë¼ìš°íŒ… (v1, v2)
    â”œâ”€â”€ serializers.py        # V1 Serializer
    â”œâ”€â”€ admin.py              # ê´€ë¦¬ì í˜ì´ì§€ ì„¤ì •
    â”œâ”€â”€ tests_nplus1.py       # (N+1 ë¬¸ì œ)ê´€ë ¨ í…ŒìŠ¤íŠ¸
    â”œâ”€â”€ tests_v2.py           # V2 í…ŒìŠ¤íŠ¸
    â”‚
    â””â”€â”€ api/v2/               # V2 API (ê°œì„ ëœ ë²„ì „)
        â”œâ”€â”€ views.py          # í–‰ìœ„ ê¸°ë°˜ ViewSet
        â”œâ”€â”€ urls.py           # V2 ë¼ìš°í„°
        â””â”€â”€ serializers.py    # V2 Serializer
```


| í•µì‹¬ ì›ì¹™ | êµ¬í˜„ ë°©ë²• | í•´ê²°í•˜ëŠ” ë¬¸ì œ |
|-----------|-----------|---------------|
| ìƒíƒœ ë¨¸ì‹  ëª¨ë¸ë§ | í–‰ìœ„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤ ì—”ë“œí¬ì¸íŠ¸ | ëª¨í˜¸í•œ ìƒíƒœ ì „ì´, ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ í˜¼ì¬ |
| ë©±ë“±ì„± ë³´ì¥ | Idempotency-Key í—¤ë” | ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì¤‘ë³µ ì²˜ë¦¬ |
| ë‚™ê´€ì  ë½ | ETag + If-Match í—¤ë” | ë™ì‹œì„± ì¶©ëŒ (Race Condition) |
| íš¨ìœ¨ì  ë°ì´í„° ì œê³µ | ì‚¬ì´ë“œë¡œë”© / GraphQL | N+1 ë¬¸ì œ, ê³¼ë‹¤/ë¶€ì¡± ë°ì´í„° ì „ì†¡ |
| ë²„ì „ ê´€ë¦¬ | URI ê²½ë¡œ ê¸°ë°˜ ë²„ì „ ê´€ë¦¬ | ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ í˜¸í™˜ì„± |

---

### ğŸ”¹ êµ¬í˜„ í˜„í™©

ì´ ìë£Œë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒì„ êµ¬í˜„:

- [x] V2 REST API ì„¤ê³„ ë° êµ¬í˜„
- [x] í–‰ìœ„ ê¸°ë°˜ ë¦¬ì†ŒìŠ¤ ì—”ë“œí¬ì¸íŠ¸ êµ¬ì¶• (7ê°œ ì™„ë£Œ)
- [x] API ë²„ì „ ê´€ë¦¬ ì²´ê³„ ìˆ˜ë¦½ (`/api/v1/`, `/api/v2/`)
- [x] Idempotency-Key ê¸°ë°˜ ë©±ë“±ì„± ë³´ì¥ ë¯¸ë“¤ì›¨ì–´
- [x] ETag/If-Match ê¸°ë°˜ ë‚™ê´€ì  ë½ êµ¬í˜„
- [x] ì‚¬ì´ë“œë¡œë”© ê¸°ëŠ¥ êµ¬í˜„ (`?include=`)

#### êµ¬í˜„ëœ V2 ì—”ë“œí¬ì¸íŠ¸

| ì—”ë“œí¬ì¸íŠ¸ | í–‰ìœ„ì | í—ˆìš© ìƒíƒœ | ê²°ê³¼ ìƒíƒœ |
|-----------|--------|----------|----------|
| `POST /orders/{id}/payment/` | ê³ ê° | pending_payment | pending_acceptance |
| `POST /orders/{id}/cancellation/` | ê³ ê° | pending_payment, pending_acceptance | cancelled |
| `POST /orders/{id}/acceptance/` | ë ˆìŠ¤í† ë‘ | pending_acceptance | preparing |
| `POST /orders/{id}/rejection/` | ë ˆìŠ¤í† ë‘ | pending_acceptance | rejected |
| `POST /orders/{id}/preparation-complete/` | ë ˆìŠ¤í† ë‘ | preparing | ready_for_pickup |
| `POST /orders/{id}/pickup/` | ë¼ì´ë” | ready_for_pickup | in_transit |
| `POST /orders/{id}/delivery/` | ë¼ì´ë” | in_transit | delivered |

---

### ğŸ”¹ í–¥í›„ í™•ì¥ ë° ê°œì„  ê³„íš (Future Plans)

í˜„ì¬ì˜ V2 APIëŠ” í•µì‹¬ ì£¼ë¬¸ ë¡œì§ì˜ ì •í•©ì„±ì„ í™•ë³´í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.  
ì‹¤ì œ ìƒìš© ìˆ˜ì¤€ì˜ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ê³  ì„œë¹„ìŠ¤ë¥¼ í™•ì¥í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ìˆ ì  ê°œì„ ë“¤ì´ ê³„íšë˜ì–´ ìˆìŠµë‹ˆë‹¤.

##### 1. ì¸ì¦ ë° ì¸ê°€ ê³ ë„í™” (Authentication & Authorization)
- **í˜„í™©**: í˜„ì¬ëŠ” ê°„ë‹¨í•œ ì„¸ì…˜ ê¸°ë°˜ ë˜ëŠ” ê°œë°œ í¸ì˜ë¥¼ ìœ„í•œ ì—´ë¦° êµ¬ì¡°ì…ë‹ˆë‹¤.
- **ê³„íš**: 
  - **JWT (JSON Web Token)** ë„ì…ìœ¼ë¡œ Statelessí•œ ì¸ì¦ ì²´ê³„ êµ¬ì¶•.
  - **RBAC (Role-Based Access Control)** ë¯¸ë“¤ì›¨ì–´ë¥¼ ë„ì…í•˜ì—¬ ê³ ê°/ì ì£¼/ë¼ì´ë”ì˜ ê¶Œí•œì„ API ë ˆë²¨ì—ì„œ ì—„ê²©í•˜ê²Œ ë¶„ë¦¬.

##### 2. ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ (Asynchronous Processing)
- **í˜„í™©**: ì£¼ë¬¸ ì²˜ë¦¬ ë¡œì§ì´ ë™ê¸°(Synchronous) ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
- **ê³„íš**: 
  - **Celery + Redis**ë¥¼ ë„ì…í•˜ì—¬ 'ì•Œë¦¼ ë°œì†¡', 'ë°°ë‹¬ë£Œ ì •ì‚°', 'í†µê³„ ì§‘ê³„' ë“± ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ ë°±ê·¸ë¼ìš´ë“œ íë¡œ ì´ê´€.
  - ì‚¬ìš©ì ì‘ë‹µ ì†ë„ í–¥ìƒ ë° ì„œë²„ ë¦¬ì†ŒìŠ¤ íš¨ìœ¨í™”.

##### 3. ì‹¤ì‹œê°„ ìœ„ì¹˜ ê´€ì œ (Real-time Communication)
- **í˜„í™©**: ë¼ì´ë” ìœ„ì¹˜ë‚˜ ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ì„ í™•ì¸í•˜ë ¤ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ ì£¼ê¸°ì ìœ¼ë¡œ Pollingí•´ì•¼ í•©ë‹ˆë‹¤.
- **ê³„íš**: 
  - **WebSockets (Django Channels)** ë„ì….
  - ë¼ì´ë”ì˜ ì‹¤ì‹œê°„ ìœ„ì¹˜ë¥¼ ì§€ë„ì— ë§¤í•‘í•˜ê³ , ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ ì‹œ í‘¸ì‹œ ì•Œë¦¼ì„ ì „ì†¡í•˜ëŠ” ì–‘ë°©í–¥ í†µì‹  êµ¬í˜„.

##### 4. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ (MSA) ì „í™˜ ì¤€ë¹„
- **í˜„í™©**: ë‹¨ì¼ ëª¨ë†€ë¦¬ì‹(Monolithic) Django ì•± êµ¬ì¡°ì…ë‹ˆë‹¤.
- **ê³„íš**: 
  - ë„ë©”ì¸ ë³µì¡ë„ê°€ ì¦ê°€í•¨ì— ë”°ë¼ **ì£¼ë¬¸(Order)**, **ê²°ì œ(Payment)**, **ë°°ë‹¬(Delivery)** ì„œë¹„ìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ë¶„ë¦¬.
  - ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì„ ìœ„í•´ **Kafka** ë˜ëŠ” **RabbitMQ**ì™€ ê°™ì€ ë©”ì‹œì§€ ë¸Œë¡œì»¤ ë„ì…í•˜ì—¬ ê²°í•©ë„ ê°ì†Œ.

##### 5. ëª¨ë‹ˆí„°ë§ ë° í…ŒìŠ¤íŠ¸ ìë™í™” (Observability & CI/CD)
- **ê³„íš**: 
  - **Sentry** ì—°ë™ìœ¼ë¡œ ì‹¤ì‹œê°„ ì—ëŸ¬ ì¶”ì .
  - **Prometheus & Grafana**ë¥¼ í™œìš©í•œ API ìš”ì²­ëŸ‰ ë° ì‘ë‹µ ì§€ì—°ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶•.
  - GitHub Actionsë¥¼ í†µí•œ **CI/CD íŒŒì´í”„ë¼ì¸** êµ¬ì¶•ìœ¼ë¡œ ë°°í¬ ìë™í™”.
