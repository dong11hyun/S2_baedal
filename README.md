# REST API μ‹¬μΈµ νƒκµ¬: μ‹¤μ‹κ°„ μ£Όλ¬Έ μ²λ¦¬ μ‹μ¤ν…μ μƒνƒ μ „μ΄μ™€ λ™μ‹μ„± μ μ–΄
---
> λ€κ·λ¨ λ°°λ‹¬ ν”λ«νΌμ—μ„ λ°μƒν•  μ μλ” **λ™μ‹μ„± λ¬Έμ **μ™€ **λ°μ΄ν„° μ •ν•©μ„± μ΄μ**λ¥Ό 
λ¶„μ„ν•κ³ , μ΄λ¥Ό ν•΄κ²°ν•λ” **RESTful API μ„¤κ³„ ν¨ν„΄**μ„ μ—°κµ¬/κµ¬ν„ν• ν”„λ΅μ νΈμ…λ‹λ‹¤.

> λ°°λ‹¬ ν”λ«νΌμ²λΌ μ—¬λ¬ ν–‰μ„μ(κ³ κ°, μ μ£Ό, λΌμ΄λ”)κ°€ λ™μ‹μ— κ°™μ€ λ¦¬μ†μ¤λ¥Ό μ΅°μ‘ν•λ” μ‹μ¤ν…μ—μ„λ” λ°μ΄ν„° μ •ν•©μ„± λ¬Έμ κ°€ ν•„μ—°μ μΌλ΅ λ°μƒν•©λ‹λ‹¤.

> μ΄λ΅ μΌλ΅λ§ μ•κ³  μλ λ™μ‹μ„± μ μ–΄, λ©±λ“±μ„± λ³΄μ¥ ν¨ν„΄μ„
μ‹¤μ λ΅ κµ¬ν„ν•κ³  ν…μ¤νΈν•΄λ³΄λ©΄μ„ κΉμ΄ μκ² μ΄ν•΄ν–λ ν”„λ΅μ νΈ

## π“λ©μ°¨

1. [π¤”μƒν™© λ° λ¬Έμ μ ](#μƒν™©-λ°-λ¬Έμ μ )
   - [λ¬Έμ  1. λ¨νΈν• μƒνƒ μ „μ΄ API](#λ¬Έμ -1-λ¨νΈν•-μƒνƒ-μ „μ΄-api)
   - [λ¬Έμ  2. μΉλ…μ μΈ λ™μ‹μ„± λ¬Έμ ](#λ¬Έμ -2-μΉλ…μ μΈ-λ™μ‹μ„±-λ¬Έμ -race-condition)
   - [λ¬Έμ  3. λ©±λ“±μ„± λ¶€μ¬](#λ¬Έμ -3-λ©±λ“±μ„±idempotency-λ¶€μ¬)
   - [λ¬Έμ  4. λ°μ΄ν„° λ΅λ”© λΉ„ν¨μ¨](#λ¬Έμ -4-λ°μ΄ν„°-λ΅λ”©-λΉ„ν¨μ¨-n1-λ¬Έμ )
2. [π§ν•΄κ²° κ³Όμ •](#ν•΄κ²°-κ³Όμ •)
   - [μ§λ¬Έ 1: ν–‰μ„ κΈ°λ° λ¦¬μ†μ¤ μ„¤κ³„](#μ§λ¬Έ-1-ν–‰μ„-κΈ°λ°-λ¦¬μ†μ¤-μ„¤κ³„)
   - [μ§λ¬Έ 2: λ©±λ“±μ„± λ³΄μ¥](#μ§λ¬Έ-2-λ©±λ“±μ„±idempotency-λ³΄μ¥)
   - [μ§λ¬Έ 3: λ‚™κ΄€μ  λ½ κµ¬ν„](#μ§λ¬Έ-3-λ‚™κ΄€μ -λ½optimistic-locking-κµ¬ν„)
   - [μ§λ¬Έ 4: N+1 λ¬Έμ  ν•΄κ²° μ „λµ](#μ§λ¬Έ-4-n1-λ¬Έμ -ν•΄κ²°-μ „λµ)
   - [μ§λ¬Έ 5: API λ²„μ „ κ΄€λ¦¬ μ „λµ](#μ§λ¬Έ-5-api-λ²„μ „-κ΄€λ¦¬-μ „λµ)
3. [π“– ν”„λ΅μ νΈ κµ¬μ΅° & κµ¬ν„](#-ν”„λ΅μ νΈ-κµ¬μ΅°--κµ¬ν„)
   - [ν•µμ‹¬ ν–‰μ„μ](#-ν•µμ‹¬-ν–‰μ„μ-actors)
   - [μ£Όλ¬Έ μƒλ…μ£ΌκΈ°](#-μ£Όλ¬Έorderμ-ν•µμ‹¬-μƒλ…μ£ΌκΈ°)
   - [μ‹¤ν–‰ κ°€μ΄λ“](#-μ‹¤ν–‰-κ°€μ΄λ“)
   - [μ£Όμ” μ—”λ“ν¬μΈνΈ](#-μ£Όμ”-μ—”λ“ν¬μΈνΈ)
   - [κµ¬ν„ ν„ν™©](#-κµ¬ν„-ν„ν™©)
   - [ν–¥ν›„ ν™•μ¥ λ° κ°μ„  κ³„ν](#-ν–¥ν›„-ν™•μ¥-λ°-κ°μ„ -κ³„ν-future-plans)

## π¤”μƒν™© λ° λ¬Έμ μ 

- λ‹Ήμ‹ μ€ κµ­λ‚΄ μµλ€ μμ‹ λ°°λ‹¬ ν”λ«νΌ **QuickEats** μ μ£Όλ¬Έ μ²λ¦¬ λ§μ΄ν¬λ΅μ„λΉ„μ¤λ¥Ό λ‹΄λ‹Ήν•λ” λ°±μ—”λ“ μ—”μ§€λ‹μ–΄μ…λ‹λ‹¤. 
- μ΄ μ„λΉ„μ¤λ” κ³ κ°, λ μ¤ν† λ‘, λΌμ΄λ”λΌλ” μ„Έ λ…μ ν–‰μ„μ(Actor) μ‚¬μ΄μ λ³µμ΅ν• μƒνΈμ‘μ©μ„ κ΄€μ¥ν•©λ‹λ‹¤.
- μ£Όλ¬Έμ μ „μ²΄ μƒλ…μ£ΌκΈ°λ¥Ό κ΄€λ¦¬ν•λ” **REST API**λ¥Ό μ™Έλ¶€μ— μ κ³µν•©λ‹λ‹¤.
- μ„λΉ„μ¤ V1 APIλ” μ΄κΈ°μ— λΉ λ¥Έ κ°λ°μ„ μ„ν•΄ **μ£Όλ¬Έ(Order)μ΄λΌλ” λ‹¨μΌ λ¦¬μ†μ¤**λ¥Ό μ¤‘μ‹¬μΌλ΅ μ„¤κ³„λμ—μµλ‹λ‹¤. 
- ν•μ§€λ§ μΌμΌ μ£Όλ¬Έλ‰μ΄ μλ°±λ§ κ±΄μ„ λ„μ–΄μ„λ©΄μ„, **V1 APIμ μ„¤κ³„μ  ν•κ³„**κ°€ λ…ν™•ν• κΈ°μ  λ¶€μ±„λ΅ λμ•„μ¤κ³  μμµλ‹λ‹¤.

μ΄λ¬ν• λ¬Έμ λ“¤μ„ ν•΄κ²°ν•κΈ° μ„ν•΄, 
- λΉ„μ¦λ‹μ¤ κ·μΉ™μ„ λ…ν™•ν ν‘ν„ν•κ³ , 
- λ™μ‹μ„±μ„ μ•μ „ν•κ² μ²λ¦¬ν•λ©°, 
- ν΄λΌμ΄μ–ΈνΈμ™€ ν¨μ¨μ μΌλ΅ μ†ν†µν•λ” **V2 API**λ¥Ό μ„¤κ³„ν•΄μ•Ό ν•©λ‹λ‹¤.


##### λ¬Έμ  1. λ¨νΈν• μƒνƒ μ „μ΄ API

**ν„μ¬ λ°©μ‹:**
```http
PUT /api/v1/orders/{order_id}
Content-Type: application/json

{ "status": "new_status" }
```

**λ¬Έμ μ :**
- λ¨λ“  μƒνƒ λ³€κ²½μ΄ λ‹¨μΌ μ—”λ“ν¬μΈνΈμ—μ„ μ²λ¦¬λ¨
- μ„λ²„ λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ κ±°λ€ν• `if-else` λ¶„κΈ°λ¬ΈμΌλ΅ κ°€λ“ μ°Έ
- κ³ κ°μ 'μ£Όλ¬Έ μ·¨μ†'μ™€ λΌμ΄λ”μ 'ν”½μ—… μ™„λ£'κ°€ λ™μΌν• API μ‚¬μ©
- λ…Όλ¦¬μ  κµ¬λ¶„μ΄ λ¨νΈν•¨

---

##### λ¬Έμ  2. μΉλ…μ μΈ λ™μ‹μ„± λ¬Έμ  (Race Condition)

**μ‹λ‚λ¦¬μ¤:**
```
μ‹κ°„ T0: κ³ κ°μ΄ {"status": "cancelled"} μ”μ²­ μ „μ†΅
μ‹κ°„ T0: λ μ¤ν† λ‘μ΄ {"status": "preparing"} μ”μ²­ μ „μ†΅ (κ±°μ λ™μ‹μ—)
κ²°κ³Ό: λ°μ΄ν„°λ² μ΄μ¤ μµμΆ… μƒνƒ μμΈ΅ λ¶κ°€
```

**κ²°κ³Ό:**
- μ΄λ―Έ μ·¨μ†λ μ£Όλ¬Έμ μμ‹μ΄ μ΅°λ¦¬λ¨
- μ‹¬κ°ν• λ°μ΄ν„° λ¶μΌμΉ λ¬Έμ  λ°μƒ

---

##### λ¬Έμ  3. λ©±λ“±μ„±(Idempotency) λ¶€μ¬

**λ¬Έμ  μ‹λ‚λ¦¬μ¤:**
1. κ³ κ°μ΄ κ²°μ  μ”μ²­ μ „μ†΅
2. λ„¤νΈμ›ν¬ λ¬Έμ λ΅ νƒ€μ„μ•„μ›ƒ λ°μƒ
3. ν΄λΌμ΄μ–ΈνΈ μ•±μ΄ μ•μ „ν•κ² μ¬μ‹λ„
4. `POST /api/v1/orders/{order_id}/pay`κ°€ λ©±λ“±μ„± λ―Έλ³΄μ¥
5. **μ¤‘λ³µ κ²°μ  λ°μƒ β†’ κΈμµ μ‚¬κ³ **

---

##### λ¬Έμ  4. λ°μ΄ν„° λ΅λ”© λΉ„ν¨μ¨ (N+1 λ¬Έμ )

**ν„μ¬ μƒν™©:**
- `GET /api/v1/orders`λ” `restaurant_id`μ™€ `rider_id`λ§ λ°ν™
- ν΄λΌμ΄μ–ΈνΈκ°€ Nκ° μ£Όλ¬Έμ— λ€ν•΄ μ¶”κ°€ Nλ²μ API νΈμ¶ ν•„μ”
  - λ μ¤ν† λ‘ μ •λ³΄ μ΅°ν Γ— N
  - λΌμ΄λ” μ„μΉ μ΅°ν Γ— N

```
μ΄ API νΈμ¶ μ = 1 (μ£Όλ¬Έ λ©λ΅) + N (λ μ¤ν† λ‘) + N (λΌμ΄λ”) = 2N + 1
```
---

## π§ν•΄κ²° κ³Όμ •

### μ§λ¬Έ 1: ν–‰μ„ κΈ°λ° λ¦¬μ†μ¤ μ„¤κ³„
- V1 APIμ λ¨νΈν• μƒνƒ μ „μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄, μ£Όλ¬Έμ μƒλ…μ£ΌκΈ°λ¥Ό RESTfulν•κ² ν‘ν„ν•λ” APIλ¥Ό μƒλ΅­κ² μ„¤κ³„ν•μ‹μ¤. 
- PUT λ©”μ„λ“μ— μμ΅΄ν•λ” λ€μ‹ , μ£Όλ¬Έμ μƒνƒλ¥Ό λ³€κ²½μ‹ν‚¤λ” κ° **'ν–‰μ„' μμ²΄λ¥Ό λ¦¬μ†μ¤λ΅ κ°„μ£Όν•λ” 'ν–‰μ„ κΈ°λ° λ¦¬μ†μ¤(Action-oriented Resource)' μ ‘κ·Όλ²•**μ„ μ‚¬μ©ν•μ—¬ API μ—”λ“ν¬μΈνΈλ¥Ό μ„¤κ³„ν•΄μ•Ό ν•©λ‹λ‹¤. 
- μλ¥Ό λ“¤μ–΄, λ μ¤ν† λ‘μ 'μ£Όλ¬Έ μ ‘μ' ν–‰μ„λ‚ κ³ κ°μ 'μ£Όλ¬Έ μ·¨μ†' ν–‰μ„λ¥Ό μ„ν• κµ¬μ²΄μ μΈ μ—”λ“ν¬μΈνΈ(HTTP λ©”μ„λ“μ™€ URI κ²½λ΅)λ¥Ό μ μ‹ν•κ³ , μ΄λ¬ν• μ„¤κ³„κ°€ μ™ V1μ— λΉ„ν•΄ μ‹μ¤ν…μ λΉ„μ¦λ‹μ¤ κ·μΉ™μ„ λ” λ…ν™•ν•κ² λ§λ“¤κ³  ν™•μ¥μ„±μ„ λ†’μ΄λ”μ§€ μ„¤λ…ν•μ‹μ¤.


**[λ‹µλ³€]**
>κΈ°μ΅΄ V1 APIμ—μ„λ” λ¨λ“  μƒνƒ λ³€κ²½μ΄ `PUT /api/v1/orders/{order_id}`λΌλ” λ‹¨μΌ μ—”λ“ν¬μΈνΈμ—μ„ `{ "status": "new_status" }` ν•νƒλ΅ μ²λ¦¬λμ—μµλ‹λ‹¤. μ΄ λ°©μ‹μ€ λΉ λ¥Έ κ°λ°μ—λ” μ λ¦¬ν•μ§€λ§, μ‹μ¤ν…μ΄ μ»¤μ§€λ©΄μ„ μ‹¬κ°ν• λ¬Έμ λ¥Ό μ•ΌκΈ°ν•©λ‹λ‹¤. μ„λ²„ μ½”λ“λ” μ „λ‹¬λ°›μ€ status κ°’μ— λ”°λΌ λ¶„κΈ°ν•΄μ•Ό ν•λ―€λ΅ κ±°λ€ν• if-else λΈ”λ΅μ΄ μƒκΈ°κ³ , λ„κ°€ μ–΄λ–¤ μƒνƒλ΅ λ³€κ²½ν•  μ μλ”μ§€μ— λ€ν• λΉ„μ¦λ‹μ¤ κ·μΉ™μ΄ μ½”λ“ κΉμ™μ΄ μ¨κ²¨μ§€κ² λ©λ‹λ‹¤.

>ν–‰μ„ κΈ°λ° λ¦¬μ†μ¤ μ„¤κ³„λ” μ΄λ¬ν• λ¬Έμ λ¥Ό κ·Όλ³Έμ μΌλ΅ ν•΄κ²°ν•©λ‹λ‹¤. ν•µμ‹¬ μ•„μ΄λ””μ–΄λ” **μƒνƒλ¥Ό λ³€κ²½ν•λ” 'ν–‰μ„' μμ²΄λ¥Ό ν•λ‚μ λ¦¬μ†μ¤λ΅ κ°„μ£Ό**ν•λ” κ²ƒμ…λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, κ³ κ°μ΄ μ£Όλ¬Έμ„ μ·¨μ†ν•λ” ν–‰μ„λ” `POST /api/v2/orders/{order_id}/cancellation`μΌλ΅, λ μ¤ν† λ‘μ΄ μ£Όλ¬Έμ„ μ ‘μν•λ” ν–‰μ„λ” `POST /api/v2/orders/{order_id}/acceptance`λ΅ ν‘ν„ν•©λ‹λ‹¤. κ° ν–‰μ„κ°€ λ³„λ„μ μ—”λ“ν¬μΈνΈλ¥Ό κ°€μ§€λ―€λ΅, ν•΄λ‹Ή μ—”λ“ν¬μΈνΈμ μ»¨νΈλ΅¤λ¬μ—μ„λ” μ¤μ§ κ·Έ ν–‰μ„μ— ν•„μ”ν• λΉ„μ¦λ‹μ¤ λ΅μ§λ§ λ‹΄λ‹Ήν•λ©΄ λ©λ‹λ‹¤.

>μ΄ μ„¤κ³„μ μ¥μ μ€ λ…ν™•ν•©λ‹λ‹¤. μ²«μ§Έ, API μμ²΄κ°€ λΉ„μ¦λ‹μ¤ κ·μΉ™μ„ λ¬Έμ„ν™”ν•©λ‹λ‹¤. κ°λ°μκ°€ API λ…μ„Έλ§ λ³΄λ”λΌλ„ "μ£Όλ¬Έ μ·¨μ†λ” cancellation μ—”λ“ν¬μΈνΈλ΅, μ£Όλ¬Έ μ ‘μλ” acceptance μ—”λ“ν¬μΈνΈλ΅ ν•λ‹¤"λ” κ²ƒμ„ μ¦‰μ‹ μ΄ν•΄ν•  μ μμµλ‹λ‹¤. λ‘μ§Έ, κ¶ν• κ²€μ¦μ΄ μ©μ΄ν•΄μ§‘λ‹λ‹¤. κ° μ—”λ“ν¬μΈνΈμ— μ ‘κ·Όν•  μ μλ” ν–‰μ„μλ¥Ό μ ν•ν•  μ μμΌλ―€λ΅, μλ¥Ό λ“¤μ–΄ cancellationμ€ κ³ κ°λ§, acceptanceλ” λ μ¤ν† λ‘λ§ νΈμ¶ν•  μ μλ„λ΅ λ―Έλ“¤μ›¨μ–΄ μμ¤€μ—μ„ μ μ–΄ν•  μ μμµλ‹λ‹¤. μ…‹μ§Έ, ν™•μ¥μ„±μ΄ λ†’μ•„μ§‘λ‹λ‹¤. μƒλ΅μ΄ λΉ„μ¦λ‹μ¤ μ”κµ¬μ‚¬ν•­μΌλ΅ 'λ¶€λ¶„ ν™λ¶' κΈ°λ¥μ΄ μ¶”κ°€λλ”λΌλ„, `POST /api/v2/orders/{order_id}/partial-refund`λΌλ” μƒ μ—”λ“ν¬μΈνΈλ¥Ό μ¶”κ°€ν•λ©΄ λλ©°, κΈ°μ΅΄ μ½”λ“μ— μν–¥μ„ μ£Όμ§€ μ•μµλ‹λ‹¤.

>κ²°λ΅ μ μΌλ΅, ν–‰μ„ κΈ°λ° λ¦¬μ†μ¤ μ„¤κ³„λ” RESTμ μ›μΉ™μ„ μ μ§€ν•λ©΄μ„λ„ λ³µμ΅ν• μƒνƒ κΈ°κ³„(State Machine)λ¥Ό κ°€μ§„ μ‹μ¤ν…μ„ κΉ”λ”ν•κ² ν‘ν„ν•  μ μλ” κ°•λ ¥ν• ν¨ν„΄μ…λ‹λ‹¤.

---
> PUT λ©”μ„λ“μ— μμ΅΄ν•λ” λ€μ‹ , μ£Όλ¬Έμ μƒνƒλ¥Ό λ³€κ²½μ‹ν‚¤λ” κ° **'ν–‰μ„' μμ²΄λ¥Ό λ¦¬μ†μ¤**λ΅ κ°„μ£Ό

**μ„¤κ³„ μμ‹:**

| ν–‰μ„ | HTTP λ©”μ„λ“ | μ—”λ“ν¬μΈνΈ | ν–‰μ„μ |
|------|-------------|-----------|--------|
| μ£Όλ¬Έ μƒμ„± | `POST` | `/api/v2/orders` | κ³ κ° |
| κ²°μ  μ”μ²­ | `POST` | `/api/v2/orders/{order_id}/payment` | κ³ κ° |
| μ£Όλ¬Έ μ·¨μ† | `POST` | `/api/v2/orders/{order_id}/cancellation` | κ³ κ° |
| μ£Όλ¬Έ μ ‘μ | `POST` | `/api/v2/orders/{order_id}/acceptance` | λ μ¤ν† λ‘ |
| μ£Όλ¬Έ κ±°μ  | `POST` | `/api/v2/orders/{order_id}/rejection` | λ μ¤ν† λ‘ |
| μ΅°λ¦¬ μ™„λ£ | `POST` | `/api/v2/orders/{order_id}/preparation-complete` | λ μ¤ν† λ‘ |
| ν”½μ—… μ™„λ£ | `POST` | `/api/v2/orders/{order_id}/pickup` | λΌμ΄λ” |
| λ°°λ‹¬ μ™„λ£ | `POST` | `/api/v2/orders/{order_id}/delivery` | λΌμ΄λ” |

**μ¥μ :**
- κ° ν–‰μ„λ³„λ΅ λ…ν™•ν• λΉ„μ¦λ‹μ¤ κ·μΉ™ μ μ© κ°€λ¥
- κ¶ν• κ²€μ¦μ΄ μ©μ΄ (ν–‰μ„μλ³„ μ—”λ“ν¬μΈνΈ λ¶„λ¦¬)
- ν™•μ¥μ„± ν–¥μƒ (μƒλ΅μ΄ ν–‰μ„ μ¶”κ°€ μ‹ κΈ°μ΅΄ μ½”λ“ μν–¥ μµμ†ν™”)

---

### μ§λ¬Έ 2: λ©±λ“±μ„±(Idempotency) λ³΄μ¥
- κ²°μ  μ¬μ‹λ„ μ‹ μ¤‘λ³µ μ²λ¦¬ λ¬Έμ λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ λ©±λ“±μ„±μ„ μ–΄λ–»κ² λ³΄μ¥ν•  κ²ƒμΈμ§€ μ„¤λ…ν•μ‹μ¤. 
- ν΄λΌμ΄μ–ΈνΈκ°€ λ„¤νΈμ›ν¬ μ¤λ¥ λ°μƒ μ‹ μ•μ „ν•κ² μ¬μ‹λ„ν•  μ μλ„λ΅, `POST /api/v2/orders/{order_id}/payment`μ™€ κ°™μ€ μ—”λ“ν¬μΈνΈλ¥Ό μ–΄λ–»κ² μμ •ν•΄μ•Ό ν•λ”μ§€ **Idempotency-Key ν—¤λ”λ¥Ό ν™μ©ν•λ” ν‘μ¤€μ μΈ λ°©λ²•**μ„ ν†µν•΄ κ·Έ μ”μ²­-μ‘λ‹µ νλ¦„κ³Ό μ„λ²„ μΈ΅μ μ²λ¦¬ λ΅μ§μ„ μƒμ„Έν κΈ°μ ν•΄μ•Ό ν•©λ‹λ‹¤.

**[λ‹µλ³€]**
> λ©±λ“±μ„±(Idempotency)μ΄λ€ λ™μΌν• μ”μ²­μ„ μ—¬λ¬ λ² μ‹¤ν–‰ν•λ”λΌλ„ κ²°κ³Όκ°€ ν• λ² μ‹¤ν–‰ν• κ²ƒκ³Ό λ™μΌν•κ² μ μ§€λλ” μ„±μ§μ…λ‹λ‹¤. HTTPμ GET, PUT, DELETE λ©”μ„λ“λ” μ„¤κ³„μƒ λ©±λ“±μ„±μ„ κ°€μ§€μ§€λ§, POSTλ” κ·Έλ ‡μ§€ μ•μµλ‹λ‹¤. λ¬Έμ λ” κ²°μ μ™€ κ°™μ΄ λ¶€μ‘μ©(side effect)μ΄ μλ” μ‘μ—…μ—μ„ λ„¤νΈμ›ν¬ μ¤λ¥κ°€ λ°μƒν–μ„ λ•μ…λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” μ”μ²­μ΄ μ„±κ³µν–λ”μ§€ μ‹¤ν¨ν–λ”μ§€ μ• μ μ—†μ–΄ μ¬μ‹λ„λ¥Ό ν•κ² λκ³ , μ΄λ΅ μΈν•΄ μ¤‘λ³µ κ²°μ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.

> μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•λ” ν‘μ¤€μ μΈ λ°©λ²•μ΄ **Idempotency-Key ν—¤λ”**μ…λ‹λ‹¤. λ™μ‘ μ›λ¦¬λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” κ²°μ  μ”μ²­μ„ λ³΄λ‚Ό λ• κ³ μ ν• Idempotency-Keyλ¥Ό μƒμ„±ν•μ—¬ ν—¤λ”μ— ν¬ν•¨μ‹ν‚µλ‹λ‹¤(μ: UUID). μ„λ²„λ” μ΄ μ”μ²­μ„ μ²λ¦¬ν•κΈ° μ „μ— λ¨Όμ € ν•΄λ‹Ή ν‚¤κ°€ μ΄λ―Έ μ²λ¦¬λ μ μ΄ μλ”μ§€ μ €μ¥μ†(Redis, DB λ“±)μ—μ„ ν™•μΈν•©λ‹λ‹¤. λ§μ•½ ν‚¤κ°€ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄, μ„λ²„λ” κ²°μ λ¥Ό μ •μƒμ μΌλ΅ μ²λ¦¬ν•κ³ , κ·Έ ν‚¤μ™€ ν•¨κ» μ‘λ‹µ κ²°κ³Όλ¥Ό μ €μ¥μ†μ— κΈ°λ΅ν•©λ‹λ‹¤. λ°λ©΄ ν‚¤κ°€ μ΄λ―Έ μ΅΄μ¬ν•λ‹¤λ©΄, μ΄κ²ƒμ€ μ¬μ‹λ„ μ”μ²­μΌλ΅ κ°„μ£Όλμ–΄ μ‹¤μ  κ²°μ  λ΅μ§μ„ μ‹¤ν–‰ν•μ§€ μ•κ³  **μ΄μ „μ— μ €μ¥ν•΄λ‘” μ‘λ‹µμ„ κ·Έλ€λ΅ λ°ν™**ν•©λ‹λ‹¤.

> μ΄ νλ¦„μ ν•µμ‹¬μ€ ν΄λΌμ΄μ–ΈνΈκ°€ λ™μΌν• Idempotency-Keyλ΅ μ—¬λ¬ λ² μ”μ²­μ„ λ³΄λ‚΄λ”λΌλ„ μ„λ²„μ—μ„λ” λ‹¨ ν• λ²λ§ μ‹¤μ  μ²λ¦¬κ°€ μ΄λ£¨μ–΄μ§„λ‹¤λ” μ μ…λ‹λ‹¤. λ„¤νΈμ›ν¬ νƒ€μ„μ•„μ›ƒμΌλ΅ ν΄λΌμ΄μ–ΈνΈκ°€ μ‘λ‹µμ„ λ°›μ§€ λ»ν•κ³  μ¬μ‹λ„λ¥Ό ν•λ”λΌλ„, μ²« λ²μ§Έ μ”μ²­μ΄ μ„±κ³µμ μΌλ΅ μ²λ¦¬λμ—λ‹¤λ©΄ λ‘ λ²μ§Έ μ”μ²­μ€ μ €μ¥λ μ„±κ³µ μ‘λ‹µμ„ λ°›κ² λκ³ , μ²« λ²μ§Έ μ”μ²­μ΄ μ‹¤ν¨ν–λ‹¤λ©΄ λ‘ λ²μ§Έ μ”μ²­μ΄ μƒλ΅μ΄ μ²λ¦¬λ΅ μ§„ν–‰λ©λ‹λ‹¤.

> μ„λ²„ κµ¬ν„ μ‹ κ³ λ ¤ν•΄μ•Ό ν•  μ μ€ Idempotency-Keyμ μ ν¨ κΈ°κ°„ μ„¤μ •(λ³΄ν†µ 24μ‹κ°„~7μΌ), κ·Έλ¦¬κ³  μ”μ²­μ΄ μ²λ¦¬ μ¤‘μΌ λ• λ™μΌν• ν‚¤λ΅ λ‹¤λ¥Έ μ”μ²­μ΄ λ“¤μ–΄μ¨ κ²½μ°λ¥Ό μ²λ¦¬ν•κΈ° μ„ν• λ½(Lock) λ©”μ»¤λ‹μ¦μ…λ‹λ‹¤. μ΄λ¬ν• κµ¬ν„μ„ ν†µν•΄ ν΄λΌμ΄μ–ΈνΈλ” μ•μ‹¬ν•κ³  μ¬μ‹λ„λ¥Ό μν–‰ν•  μ μμΌλ©°, μ¤‘λ³µ κ²°μ λ΅ μΈν• κΈμµ μ‚¬κ³ λ¥Ό μ›μ²μ μΌλ΅ μλ°©ν•  μ μμµλ‹λ‹¤.

---
**μ”μ²­-μ‘λ‹µ νλ¦„:**

```http
POST /api/v2/orders/{order_id}/payment
Content-Type: application/json
Idempotency-Key: "unique-request-id-12345"

{
  "payment_method": "card",
  "amount": 25000
}
```

**μ„λ²„ μΈ΅ μ²λ¦¬ λ΅μ§:**

```
1. Idempotency-Key ν™•μΈ
2. ν‚¤κ°€ μ €μ¥μ†μ— μ΅΄μ¬ν•λ”μ§€ ν™•μΈ
   β”β”€ μ΅΄μ¬ν•¨ β†’ μ €μ¥λ μ‘λ‹µ λ°ν™ (μ¬μ‹λ„λ΅ κ°„μ£Ό)
   β””β”€ μ΅΄μ¬ μ•ν•¨ β†’ μ”μ²­ μ²λ¦¬ μ§„ν–‰
3. μ”μ²­ μ²λ¦¬ λ° κ²°κ³Ό μ €μ¥
4. Idempotency-Keyμ™€ ν•¨κ» μ‘λ‹µ μ €μ¥μ†μ— κΈ°λ΅
5. μ‘λ‹µ λ°ν™
```

**μ¬μ‹λ„ μ‹:**
- λ™μΌν• `Idempotency-Key`λ΅ μ”μ²­
- μ„λ²„κ°€ μ €μ¥λ μ‘λ‹µ λ°ν™
- μ¤‘λ³µ κ²°μ  λ°©μ§€

---

### μ§λ¬Έ 3: λ‚™κ΄€μ  λ½(Optimistic Locking) κµ¬ν„
- κ³ κ°μ 'μ£Όλ¬Έ μ·¨μ†'μ™€ λ μ¤ν† λ‘μ 'μ£Όλ¬Έ μ ‘μ'κ°€ μ¶©λν•λ” κ²ƒκ³Ό κ°™μ€ **λ™μ‹μ„± λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν• λ‚™κ΄€μ  λ½(Optimistic Locking) μ „λµ**μ„ API μμ¤€μ—μ„ μ–΄λ–»κ² κµ¬ν„ν•  μ μμ„μ§€ μ„¤λ…ν•μ‹μ¤. 
- HTTPμ **ETagμ™€ If-Match μ΅°κ±΄λ¶€ μ”μ²­ ν—¤λ”**λ¥Ό μ‚¬μ©ν•μ—¬, ν΄λΌμ΄μ–ΈνΈκ°€ ν•­μƒ λ¦¬μ†μ¤μ μµμ‹  λ²„μ „μ„ κΈ°λ°μΌλ΅ μƒνƒ λ³€κ²½μ„ μ‹λ„ν•λ„λ΅ λ³΄μ¥ν•λ” μ „μ²΄μ μΈ κ³Όμ •μ„ μ„¤λ…ν•΄μ•Ό ν•©λ‹λ‹¤. 
- λ§μ•½ ν΄λΌμ΄μ–ΈνΈκ°€ μ¤λλ λ²„μ „μ μ •λ³΄λ¥Ό κΈ°λ°μΌλ΅ μ”μ²­ν–μ„ λ•, μ„λ²„κ°€ **412 Precondition Failed** μ‘λ‹µμ„ λ°ν™ν•μ—¬ μ¶©λμ„ λ°©μ§€ν•λ” μ‹λ‚λ¦¬μ¤λ¥Ό ν¬ν•¨ν•μ—¬ λ…Όν•μ‹μ¤.

**[λ‹µλ³€]**

> λ™μ‹μ„± λ¬Έμ λ” μ—¬λ¬ ν–‰μ„μκ°€ λ™μΌν• λ¦¬μ†μ¤λ¥Ό κ±°μ λ™μ‹μ— λ³€κ²½ν•λ ¤ ν•  λ• λ°μƒν•©λ‹λ‹¤. QuickEatsμ κ²½μ°, κ³ κ°μ΄ μ£Όλ¬Έμ„ μ·¨μ†ν•λ ¤λ” μκ°„ λ μ¤ν† λ‘μ΄ μ£Όλ¬Έμ„ μ ‘μν•λ” μƒν™©μ΄ λ€ν‘μ μ…λ‹λ‹¤. λ‘ μ”μ²­μ΄ λ¨λ‘ "μ£Όλ¬Έ μ ‘μ λ€κΈ°μ¤‘(pending_acceptance)" μƒνƒμ—μ„ μ¶λ°ν•μ§€λ§, κ²°κ³Όμ μΌλ΅ ν•λ‚λ§ μ ν¨ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄λ¥Ό ν•΄κ²°ν•λ” λ°©λ²•μΌλ΅ ν¬κ² λΉ„κ΄€μ  λ½(Pessimistic Locking)κ³Ό λ‚™κ΄€μ  λ½(Optimistic Locking)μ΄ μλ”λ°, μ›Ή API ν™κ²½μ—μ„λ” λ‚™κ΄€μ  λ½μ΄ λ” μ ν•©ν•©λ‹λ‹¤.

> λ‚™κ΄€μ  λ½μ μ² ν•™μ€ "μ¶©λμ€ λ“λ¬Όκ² λ°μƒν•λ‹¤"κ³  κ°€μ •ν•κ³ , μ¶©λμ΄ λ°μƒν–μ„ λ• μ΄λ¥Ό κ°μ§€ν•μ—¬ μ²λ¦¬ν•λ” κ²ƒμ…λ‹λ‹¤. HTTP ν‘μ¤€μ—μ„λ” μ΄λ¥Ό μ„ν•΄ **ETag(Entity Tag)**μ™€ **If-Match** ν—¤λ”λ¥Ό μ κ³µν•©λ‹λ‹¤. ETagλ” λ¦¬μ†μ¤μ νΉμ • λ²„μ „μ„ μ‹λ³„ν•λ” κ³ μ ν• κ°’μΌλ΅, λ¦¬μ†μ¤κ°€ λ³€κ²½λ  λ•λ§λ‹¤ ν•¨κ» κ°±μ‹ λ©λ‹λ‹¤.

> λ™μ‘ κ³Όμ •μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤. λ¨Όμ € ν΄λΌμ΄μ–ΈνΈκ°€ μ£Όλ¬Έ μ •λ³΄λ¥Ό μ΅°νν•λ©΄(`GET /api/v2/orders/{order_id}`), μ„λ²„λ” μ‘λ‹µ ν—¤λ”μ— ν„μ¬ λ¦¬μ†μ¤μ ETag κ°’(μ: `"abc123"`)μ„ ν¬ν•¨ν•μ—¬ λ°ν™ν•©λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” μ΄ν›„ μƒνƒ λ³€κ²½ μ”μ²­μ„ λ³΄λ‚Ό λ•, μμ‹ μ΄ λ°›μ•λ ETag κ°’μ„ `If-Match` ν—¤λ”μ— λ‹΄μ•„ μ „μ†΅ν•©λ‹λ‹¤(μ: `If-Match: "abc123"`). μ„λ²„λ” μ”μ²­μ„ μ²λ¦¬ν•κΈ° μ „μ— λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λ ν„μ¬ λ¦¬μ†μ¤μ λ²„μ „κ³Ό If-Match ν—¤λ”μ κ°’μ„ λΉ„κµν•©λ‹λ‹¤. λ‘ κ°’μ΄ μΌμΉν•λ©΄ μ”μ²­μ„ μ •μƒ μ²λ¦¬ν•κ³  μƒλ΅μ΄ ETagλ¥Ό λ°κΈ‰ν•©λ‹λ‹¤. λ§μ•½ μΌμΉν•μ§€ μ•λ”λ‹¤λ©΄, μ΄λ” ν΄λΌμ΄μ–ΈνΈκ°€ λ¦¬μ†μ¤λ¥Ό μ΅°νν• μ΄ν›„ λ‹¤λ¥Έ λ„κµ°κ°€κ°€ μ΄λ―Έ λ³€κ²½ν–λ‹¤λ” κ²ƒμ„ μλ―Έν•λ―€λ΅, μ„λ²„λ” **412 Precondition Failed** μ‘λ‹µμ„ λ°ν™ν•©λ‹λ‹¤.

> κµ¬μ²΄μ μΈ μ‹λ‚λ¦¬μ¤λ¥Ό λ“¤μ–΄λ³΄κ² μµλ‹λ‹¤. κ³ κ° μ•±κ³Ό λ μ¤ν† λ‘ μ•±μ΄ κ±°μ λ™μ‹μ— μ£Όλ¬Έ μ •λ³΄λ¥Ό μ΅°νν•μ—¬ λ‘ λ‹¤ ETag `"abc123"`μ„ λ°›μ•μµλ‹λ‹¤. λ μ¤ν† λ‘μ΄ λ¨Όμ € μ£Όλ¬Έ μ ‘μ μ”μ²­μ„ λ³΄λ‚΄λ©΄, μ„λ²„λ” μ΄λ¥Ό μ„±κ³µμ μΌλ΅ μ²λ¦¬ν•κ³  ETagλ¥Ό `"def456"`μΌλ΅ κ°±μ‹ ν•©λ‹λ‹¤. μ μ‹ ν›„ κ³ κ°μ΄ μ·¨μ† μ”μ²­μ„ `If-Match: "abc123"`κ³Ό ν•¨κ» λ³΄λ‚΄λ©΄, μ„λ²„λ” ν„μ¬ ETag `"def456"`κ³Ό μΌμΉν•μ§€ μ•μμ„ ν™•μΈν•κ³  412 μ‘λ‹µμ„ λ°ν™ν•©λ‹λ‹¤. κ³ κ° μ•±μ€ μ΄ μ‘λ‹µμ„ λ°›κ³  μ‚¬μ©μμ—κ² "μ΄λ―Έ μ£Όλ¬Έμ΄ μ ‘μλμ—μµλ‹λ‹¤. μ·¨μ†ν•  μ μ—†μµλ‹λ‹¤."λΌλ” λ©”μ‹μ§€λ¥Ό ν‘μ‹ν•  μ μμµλ‹λ‹¤.

> μ΄ λ°©μ‹μ€ λ°μ΄ν„°λ² μ΄μ¤ μμ¤€μ λ½μ„ μ¥μ‹κ°„ μ μ§€ν•μ§€ μ•μΌλ―€λ΅ μ‹μ¤ν… μ²λ¦¬λ‰μ— λ―ΈμΉλ” μν–¥μ΄ μ μΌλ©°, HTTP ν‘μ¤€μ„ ν™μ©ν•λ―€λ΅ RESTfulν• μ„¤κ³„λ¥Ό μ μ§€ν•  μ μμµλ‹λ‹¤.

---

**μ „μ²΄ νλ¦„:**

#### Step 1: λ¦¬μ†μ¤ μ΅°ν (ETag μμ‹ )
```http
GET /api/v2/orders/{order_id}

HTTP/1.1 200 OK
ETag: "abc123xyz"
Content-Type: application/json

{
  "id": "order-123",
  "status": "pending_acceptance",
  "version": 5
}
```

#### Step 2: μƒνƒ λ³€κ²½ μ”μ²­ (If-Match ν¬ν•¨)
```http
POST /api/v2/orders/{order_id}/cancellation
If-Match: "abc123xyz"
Content-Type: application/json

{
  "reason": "κ³ κ° λ³€μ‹¬"
}
```

#### μ„±κ³µ μ‹λ‚λ¦¬μ¤:
```http
HTTP/1.1 200 OK
ETag: "def456uvw"

{
  "id": "order-123",
  "status": "cancelled"
}
```

#### μ¶©λ μ‹λ‚λ¦¬μ¤ (412 Precondition Failed):
```http
HTTP/1.1 412 Precondition Failed
Content-Type: application/json

{
  "error": "conflict",
  "message": "λ¦¬μ†μ¤κ°€ μ΄λ―Έ λ³€κ²½λμ—μµλ‹λ‹¤. μµμ‹  λ²„μ „μ„ μ΅°ν ν›„ λ‹¤μ‹ μ‹λ„ν•μ„Έμ”.",
  "current_status": "preparing"
}
```

**μ¶©λ λ°©μ§€ λ©”μ»¤λ‹μ¦:**
- κ³ κ° μ·¨μ† μ”μ²­κ³Ό λ μ¤ν† λ‘ μ ‘μ μ”μ²­μ΄ λ™μ‹μ— μ¤λ©΄
- λ¨Όμ € μ²λ¦¬λ μ”μ²­μ΄ ETag κ°±μ‹ 
- λ‚μ¤‘μ— μ²λ¦¬λλ” μ”μ²­μ€ If-Match λ¶μΌμΉλ΅ 412 λ°ν™

---

### μ§λ¬Έ 4: N+1 λ¬Έμ  ν•΄κ²° μ „λµ
ν΄λΌμ΄μ–ΈνΈ μ•±μ N+1 μ΅°ν λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν• **λ‘ κ°€μ§€ μ„λ΅ λ‹¤λ¥Έ λ°μ΄ν„° μ κ³µ μ „λµ**μ„ μ μ‹ν•κ³  λΉ„κµν•μ‹μ¤.
- **μ²« λ²μ§Έ**: RESTful APIμ μ μ—°μ„±μ„ μ μ§€ν•λ©΄μ„ κ΄€λ ¨ λ¦¬μ†μ¤λ¥Ό ν•¨κ» ν¬ν•¨ν•μ—¬ μ „λ‹¬ν•λ” **'μ»΄νμ΄λ“ λ„νλ¨ΌνΈ(Compound Document)' λλ” 'μ‚¬μ΄λ“λ΅λ”©(Side-loading)'** λ°©μ‹μ„ `?include=restaurant,rider`μ™€ κ°™μ€ μΏΌλ¦¬ νλΌλ―Έν„°λ¥Ό ν†µν•΄ μ–΄λ–»κ² κµ¬ν„ν•  μ μλ”μ§€ μ„¤λ…ν•΄μ•Ό ν•©λ‹λ‹¤.
- **λ‘ λ²μ§Έ**: λ€μ•μ μΈ μ•„ν‚¤ν…μ²λ΅μ„ **GraphQL**μ„ λ„μ…ν•λ‹¤λ©΄ μ΄ λ¬Έμ κ°€ μ–΄λ–»κ² λ” κ·Όλ³Έμ μΌλ΅ ν•΄κ²°λ  μ μλ”μ§€, ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”ν• λ°μ΄ν„°μ κµ¬μ΅°λ¥Ό μ§μ ‘ μ •μν•λ” GraphQLμ νΉμ§•μ„ μ¤‘μ‹¬μΌλ΅ λ‘ λ°©μ‹μ μ¥λ‹¨μ μ„ κΈ°μ ν•μ‹μ¤.

**[λ‹µλ³€]**

> N+1 λ¬Έμ λ” REST APIμ—μ„ ν”ν λ°μƒν•λ” μ„±λ¥ μ΄μμ…λ‹λ‹¤. μ£Όλ¬Έ λ©λ΅ ν™”λ©΄μ—μ„ Nκ°μ μ£Όλ¬Έκ³Ό ν•¨κ» κ° μ£Όλ¬Έμ λ μ¤ν† λ‘ μ΄λ¦„, λΌμ΄λ” μ„μΉλ¥Ό λ³΄μ—¬μ¤μ•Ό ν•λ‹¤λ©΄, κΈ°μ΅΄ V1 APIλ΅λ” 1λ²(μ£Όλ¬Έ λ©λ΅) + Nλ²(λ μ¤ν† λ‘ μ΅°ν) + Nλ²(λΌμ΄λ” μ΅°ν) = 2N+1λ²μ API νΈμ¶μ΄ ν•„μ”ν•©λ‹λ‹¤. μ΄λ” λ„¤νΈμ›ν¬ μ§€μ—°μ„ λ„μ μ‹ν‚¤κ³  μ„λ²„ λ¶€ν•λ¥Ό μ¦κ°€μ‹ν‚µλ‹λ‹¤.

> **μ²« λ²μ§Έ ν•΄κ²°μ±…μ€ μ‚¬μ΄λ“λ΅λ”©(Side-loading) λ°©μ‹**μ…λ‹λ‹¤. μ΄ λ°©μ‹μ€ μΏΌλ¦¬ νλΌλ―Έν„°λ¥Ό ν†µν•΄ ν•¨κ» μ΅°νν•  κ΄€λ ¨ λ¦¬μ†μ¤λ¥Ό μ§€μ •ν•  μ μκ² ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄ `GET /api/v2/orders?include=restaurant,rider`λ΅ μ”μ²­ν•λ©΄, μ„λ²„λ” μ£Όλ¬Έ λ°μ΄ν„°μ™€ ν•¨κ» κ΄€λ ¨λ λ μ¤ν† λ‘κ³Ό λΌμ΄λ” μ •λ³΄λ¥Ό μ‘λ‹µμ— ν¬ν•¨μ‹ν‚µλ‹λ‹¤. μ‘λ‹µ κµ¬μ΅°λ” κΈ°λ³Έ λ°μ΄ν„°(`data`)μ™€ ν¬ν•¨λ λ¦¬μ†μ¤(`included`)λ΅ λ¶„λ¦¬λ©λ‹λ‹¤. μ΄ λ°©μ‹μ μ¥μ μ€ κΈ°μ΅΄ REST μ•„ν‚¤ν…μ²λ¥Ό μ μ§€ν•λ©΄μ„ μ μ§„μ μΌλ΅ λ„μ…ν•  μ μλ‹¤λ” κ²ƒμ…λ‹λ‹¤. λν• ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”ν•  λ•λ§ κ΄€λ ¨ λ¦¬μ†μ¤λ¥Ό μ”μ²­ν•  μ μμΌλ―€λ΅ μ μ—°ν•©λ‹λ‹¤. λ‹¨μ μ€ μ„λ²„μ—μ„ μ§€μ›ν•λ” include μµμ…μ μ΅°ν•©μ— μ ν•μ΄ μμ„ μ μκ³ , λ¶ν•„μ”ν• ν•„λ“κΉμ§€ λ¨λ‘ μ „μ†΅λ  μ μλ‹¤λ” μ μ…λ‹λ‹¤.

> **λ‘ λ²μ§Έ ν•΄κ²°μ±…μ€ GraphQL λ„μ…**μ…λ‹λ‹¤. GraphQLμ€ ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”ν• λ°μ΄ν„°μ κµ¬μ΅°λ¥Ό μ§μ ‘ μΏΌλ¦¬λ΅ μ •μν•λ” λ°©μ‹μ…λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” "μ£Όλ¬Έμ id, status, κ·Έλ¦¬κ³  λ μ¤ν† λ‘μ name, λΌμ΄λ”μ nameκ³Ό currentLocationλ§ ν•„μ”ν•λ‹¤"κ³  λ…μ‹μ μΌλ΅ μ”μ²­ν•  μ μμµλ‹λ‹¤. μ„λ²„λ” μ •ν™•ν μ”μ²­λ λ°μ΄ν„°λ§ λ°ν™ν•λ―€λ΅, κ³Όλ‹¤ μ „μ†΅(Over-fetching)κ³Ό λ¶€μ΅± μ „μ†΅(Under-fetching) λ¬Έμ κ°€ λ³Έμ§μ μΌλ΅ ν•΄κ²°λ©λ‹λ‹¤.

> λ‘ λ°©μ‹μ„ λΉ„κµν•λ©΄, μ‚¬μ΄λ“λ΅λ”©μ€ κΈ°μ΅΄ REST μΈν”„λΌλ¥Ό ν™μ©ν•  μ μμ–΄ λ„μ… λΉ„μ©μ΄ λ‚®μ§€λ§ μ μ—°μ„±μ— ν•κ³„κ°€ μμµλ‹λ‹¤. GraphQLμ€ ν΄λΌμ΄μ–ΈνΈμ—κ² μµλ€μ μ μ—°μ„±μ„ μ κ³µν•μ§€λ§, μƒλ΅μ΄ μ¤ν‚¤λ§ μ„¤κ³„, ν•™μµ λΉ„μ©, μΊμ‹± μ „λµ μ¬κ³ λ ¤ λ“± λ„μ… μ¥λ²½μ΄ λ†’μµλ‹λ‹¤. λν• GraphQLμ€ λ‹¨μΌ μ—”λ“ν¬μΈνΈλ΅ λ™μ‘ν•λ―€λ΅ HTTP μΊμ‹±μ΄ μ–΄λ µκ³ , λ³µμ΅ν• μΏΌλ¦¬λ΅ μΈν• μ„λ²„ λ¶€ν•λ¥Ό μ μ–΄ν•κΈ° μ„ν•΄ μΏΌλ¦¬ λ³µμ΅λ„ λ¶„μ„ κΈ°λ¥μ΄ ν•„μ”ν•  μ μμµλ‹λ‹¤.

> μ‹¤λ¬΄μ—μ„λ” μ‹μ¤ν…μ λ³µμ΅λ„μ™€ ν€μ μ—­λ‰μ— λ”°λΌ μ„ νƒν•©λ‹λ‹¤. μƒλ€μ μΌλ΅ λ‹¨μν• κ΄€κ³„λ¥Ό κ°€μ§„ μ‹μ¤ν…μ΄λ‚ μ΄λ―Έ RESTμ— μµμ™ν• ν€μ΄λΌλ©΄ μ‚¬μ΄λ“λ΅λ”©μ΄ ν„μ‹¤μ μΈ μ„ νƒμ΄κ³ , λ‹¤μ–‘ν• ν΄λΌμ΄μ–ΈνΈ(μ›Ή, λ¨λ°”μΌ, νƒλΈ”λ¦Ώ)κ°€ κ°κΈ° λ‹¤λ¥Έ λ°μ΄ν„°λ¥Ό ν•„μ”λ΅ ν•λ” λ³µμ΅ν• μ‹μ¤ν…μ΄λΌλ©΄ GraphQLμ΄ μ¥κΈ°μ μΌλ΅ λ” ν¨μ¨μ μΌ μ μμµλ‹λ‹¤.

---

#### λ°©λ²• 1: μ»΄νμ΄λ“ λ„νλ¨ΌνΈ / μ‚¬μ΄λ“λ΅λ”© (Side-loading)

**μ”μ²­:**
```http
GET /api/v2/orders?include=restaurant,rider
```

**μ‘λ‹µ:**
```json
{
  "data": [
    {
      "id": "order-123",
      "status": "in_transit",
      "restaurant_id": "rest-456",
      "rider_id": "rider-789"
    }
  ],
  "included": {
    "restaurants": [
      {
        "id": "rest-456",
        "name": "λ§›μλ” μΉν‚¨μ§‘",
        "address": "μ„μΈμ‹ κ°•λ‚¨κµ¬..."
      }
    ],
    "riders": [
      {
        "id": "rider-789",
        "name": "κΉ€λ°°λ‹¬",
        "current_location": { "lat": 37.5, "lng": 127.0 }
      }
    ]
  }
}
```

| μ¥μ  | λ‹¨μ  |
|------|------|
| RESTful μ›μΉ™ μ μ§€ | μ„λ²„μ—μ„ μ§€μ›ν•λ” μ΅°ν•©λ§ κ°€λ¥ |
| κΈ°μ΅΄ μΈν”„λΌ ν™μ© κ°€λ¥ | μΏΌλ¦¬ νλΌλ―Έν„° λ³µμ΅ν•΄μ§ μ μμ |
| κµ¬ν„ μƒλ€μ μΌλ΅ λ‹¨μ | κ³Όλ‹¤ λ°μ΄ν„° μ „μ†΅(Over-fetching) κ°€λ¥ |

---

#### λ°©λ²• 2: GraphQL λ„μ…

**μ”μ²­:**
```graphql
query {
  orders {
    id
    status
    restaurant {
      name
      address
    }
    rider {
      name
      currentLocation {
        lat
        lng
      }
    }
  }
}
```

**μ‘λ‹µ:**
```json
{
  "data": {
    "orders": [
      {
        "id": "order-123",
        "status": "in_transit",
        "restaurant": {
          "name": "λ§›μλ” μΉν‚¨μ§‘",
          "address": "μ„μΈμ‹ κ°•λ‚¨κµ¬..."
        },
        "rider": {
          "name": "κΉ€λ°°λ‹¬",
          "currentLocation": { "lat": 37.5, "lng": 127.0 }
        }
      }
    ]
  }
}
```

| μ¥μ  | λ‹¨μ  |
|------|------|
| ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”ν• λ°μ΄ν„° μ§μ ‘ μ •μ | ν•™μµ κ³΅μ„  μ΅΄μ¬ |
| κ³Όλ‹¤/λ¶€μ΅± λ°μ΄ν„° μ „μ†΅ λ¬Έμ  κ·Όλ³Έ ν•΄κ²° | μΊμ‹± λ³µμ΅λ„ μ¦κ°€ |
| λ‹¨μΌ μ”μ²­μΌλ΅ λ³µμ΅ν• λ°μ΄ν„° μ΅°ν κ°€λ¥ | μ„λ²„ λ³µμ΅λ„ μ¦κ°€ |
| κ°•λ ¥ν• νƒ€μ… μ‹μ¤ν… | κΈ°μ΅΄ REST μΈν”„λΌ λ€μ²΄ ν•„μ” |

---

### μ§λ¬Έ 5: API λ²„μ „ κ΄€λ¦¬ μ „λµ
- κΈ°μ΅΄ V1 APIλ¥Ό μ‚¬μ©ν•λ” κµ¬λ²„μ „ μ•± μ‚¬μ©μλ“¤μ„ μ¤‘λ‹¨ μ—†μ΄ μ§€μ›ν•λ©΄μ„, μƒλ΅μ΄ V2 APIλ¥Ό μ•μ „ν•κ² μ¶μ‹ν•κΈ° μ„ν• **API λ²„μ „ κ΄€λ¦¬ μ „λµ**μ„ μ μ‹ν•μ‹μ¤. 
- κ°€μ¥ λ„λ¦¬ μ‚¬μ©λλ” **URI κ²½λ΅ κΈ°λ° λ²„μ „ κ΄€λ¦¬**(μ: `/api/v2/...`) λ°©μ‹μ μ¥μ μ„ μ„¤λ…ν•κ³ , μ΄λ¥Ό Djangoμ™€ κ°™μ€ μ›Ή ν”„λ μ„μ›ν¬μ—μ„ μ–΄λ–»κ² κµ¬ν„ν•  μ μλ”μ§€ κΈ°μ ν•΄μ•Ό ν•©λ‹λ‹¤.

**[λ‹µλ³€]**

> API λ²„μ „ κ΄€λ¦¬λ” κΈ°μ΅΄ μ‚¬μ©μμ μ„λΉ„μ¤ μ—°μ†μ„±μ„ λ³΄μ¥ν•λ©΄μ„ μƒλ΅μ΄ κΈ°λ¥μ„ μ•μ „ν•κ² λ°°ν¬ν•κΈ° μ„ν•΄ ν•„μμ μ…λ‹λ‹¤. API λ²„μ „ κ΄€λ¦¬μ—λ” μ—¬λ¬ λ°©λ²•μ΄ μμµλ‹λ‹¤. URI κ²½λ΅μ— λ²„μ „μ„ ν¬ν•¨ν•λ” λ°©μ‹(`/api/v1/`, `/api/v2/`), μΏΌλ¦¬ νλΌλ―Έν„° λ°©μ‹(`?version=2`), μ»¤μ¤ν…€ ν—¤λ” λ°©μ‹(`X-API-Version: 2`), Accept ν—¤λ”μ λ―Έλ””μ–΄ νƒ€μ… λ°©μ‹(`Accept: application/vnd.quickeats.v2+json`) λ“±μ΄ μμµλ‹λ‹¤.

> μ΄ μ¤‘ **URI κ²½λ΅ κΈ°λ° λ²„μ „ κ΄€λ¦¬**κ°€ κ°€μ¥ λ„λ¦¬ μ‚¬μ©λλ” μ΄μ λ” λ…ν™•ν•©λ‹λ‹¤. μ²«μ§Έ, μ§κ΄€μ μ΄κ³  κ°€μ‹μ„±μ΄ λ†’μµλ‹λ‹¤. URLλ§ λ³΄κ³ λ„ μ–΄λ–¤ λ²„μ „μ APIλ¥Ό μ‚¬μ©ν•λ”μ§€ μ¦‰μ‹ μ• μ μμµλ‹λ‹¤. λ‘μ§Έ, λΈλΌμ°μ €μ—μ„ μ‰½κ² ν…μ¤νΈν•  μ μμµλ‹λ‹¤. λ³„λ„μ ν—¤λ” μ„¤μ • μ—†μ΄ μ£Όμ†μ°½μ— μ§μ ‘ μ…λ ¥ν•μ—¬ κ²°κ³Όλ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤. μ…‹μ§Έ, μΊμ‹± μ •μ±…μ„ λ²„μ „λ³„λ΅ λ…λ¦½μ μΌλ΅ μ μ©ν•  μ μμµλ‹λ‹¤. CDNμ΄λ‚ ν”„λ΅μ‹ μ„λ²„μ—μ„ URL κΈ°λ° μΊμ‹±μ΄ μμ—°μ¤λ½κ² μ΄λ£¨μ–΄μ§‘λ‹λ‹¤. λ„·μ§Έ, λ΅λ“ λ°Έλ°μ„λ‚ API κ²μ΄νΈμ›¨μ΄μ—μ„ λ²„μ „λ³„ λΌμ°ν…μ„ μ‰½κ² κµ¬μ„±ν•  μ μμµλ‹λ‹¤.

> Djangoμ—μ„ μ΄λ¥Ό κµ¬ν„ν•λ” λ°©λ²•μ€ κ°„λ‹¨ν•©λ‹λ‹¤. λ²„μ „λ³„λ΅ λ³„λ„μ μ•± λλ” λ¨λ“μ„ λ§λ“¤κ³ , μµμƒμ„ URL μ„¤μ •μ—μ„ κ° λ²„μ „μ— ν•΄λ‹Ήν•λ” κ²½λ΅λ¥Ό λΌμ°ν…ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄ `api/v1/` κ²½λ΅λ” v1 λ¨λ“μ URL μ„¤μ •μΌλ΅, `api/v2/` κ²½λ΅λ” v2 λ¨λ“μ URL μ„¤μ •μΌλ΅ μ—°κ²°ν•©λ‹λ‹¤. μ΄λ ‡κ² ν•λ©΄ V1κ³Ό V2μ μ½”λ“κ°€ λ¬Όλ¦¬μ μΌλ΅ λ¶„λ¦¬λμ–΄, ν• λ²„μ „μ μμ •μ΄ λ‹¤λ¥Έ λ²„μ „μ— μν–¥μ„ μ£Όμ§€ μ•μµλ‹λ‹¤.

> λ²„μ „ μ „ν™μ„ μ„ν• μ‹¤μ  μ΄μ μ „λµμ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤. λ¨Όμ € V2 APIλ¥Ό κ°λ°ν•κ³  μ¶©λ¶„ν ν…μ¤νΈν•©λ‹λ‹¤. κ·Έ ν›„ V1κ³Ό V2λ¥Ό λ™μ‹μ— μ΄μν•λ” λ³‘λ ¬ μ΄μ κΈ°κ°„μ„ κ°€μ§‘λ‹λ‹¤. μ΄ κΈ°κ°„ λ™μ• μ‹ κ· μ•± λ²„μ „μ€ V2λ¥Ό μ‚¬μ©ν•λ„λ΅ ν•κ³ , κµ¬λ²„μ „ μ•±μ€ κ³„μ† V1μ„ μ‚¬μ©ν•©λ‹λ‹¤. V1 μ‚¬μ©λ¥ μ„ λ¨λ‹ν„°λ§ν•λ©΄μ„ μ¶©λ¶„ν κ°μ†ν•λ©΄, V1 Deprecation κ³µμ§€λ¥Ό λ°ν–‰ν•©λ‹λ‹¤. λ³΄ν†µ 6κ°μ›”μ—μ„ 1λ…„ μ •λ„μ μ μ κΈ°κ°„μ„ λ‘κ³ , μ΄ν›„ V1 μ„λΉ„μ¤λ¥Ό μΆ…λ£ν•©λ‹λ‹¤. μ΄ κ³Όμ •μ—μ„ V1 μ”μ²­μ— λ€ν•΄ κ²½κ³  ν—¤λ”(`Deprecation` λλ” `Sunset`)λ¥Ό ν¬ν•¨μ‹μΌ ν΄λΌμ΄μ–ΈνΈ κ°λ°μμ—κ² λ§μ΄κ·Έλ μ΄μ…μ„ μ λ„ν•  μ μμµλ‹λ‹¤.

> κ²°λ΅ μ μΌλ΅, URI κ²½λ΅ κΈ°λ° λ²„μ „ κ΄€λ¦¬λ” κµ¬ν„μ΄ κ°„λ‹¨ν•κ³  μ΄μμ΄ λ…ν™•ν•μ—¬ λ€λ¶€λ¶„μ μƒν™©μ—μ„ κ¶μ¥λλ” λ°©μ‹μ…λ‹λ‹¤.
---
#### URI κ²½λ΅ κΈ°λ° λ²„μ „ κ΄€λ¦¬

```
/api/v1/orders  β†’  κΈ°μ΅΄ μ‚¬μ©μ μ§€μ›
/api/v2/orders  β†’  μƒλ΅μ΄ κΈ°λ¥
```

**μ¥μ :**
- λ…ν™•ν•κ³  μ§κ΄€μ 
- λΈλΌμ°μ €μ—μ„ μ‰½κ² ν…μ¤νΈ κ°€λ¥
- μΊμ‹± μ •μ±… λ²„μ „λ³„ λ…λ¦½ μ μ© κ°€λ¥
- λ΅λ“ λ°Έλ°μ„μ—μ„ λ²„μ „λ³„ λΌμ°ν… μ©μ΄


**urls.py (orders/urls.py):**
```python
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import OrderV1ViewSet

router = DefaultRouter()
router.register(r'orders', OrderV1ViewSet)

urlpatterns = [
    path('v1/', include(router.urls)),           # /api/v1/orders/
    path('v2/', include('orders.api.v2.urls')),  # /api/v2/orders/
]
```

**λ²„μ „ μ „ν™ μ „λµ:**
1. V2 API κ°λ° λ° ν…μ¤νΈ
2. V1κ³Ό V2 λ™μ‹ μ΄μ (λ³‘λ ¬ μ΄μ κΈ°κ°„)
3. μ‹ κ· μ•± λ²„μ „μ—μ„ V2 μ‚¬μ©
4. V1 μ‚¬μ©λ¥  λ¨λ‹ν„°λ§
5. V1 Deprecation κ³µμ§€
6. μ¶©λ¶„ν• μ μ κΈ°κ°„ ν›„ V1 μΆ…λ£
---




## π“– ν”„λ΅μ νΈ κµ¬μ΅° & κµ¬ν„ 

### π”Ή ν•µμ‹¬ ν–‰μ„μ (Actors)
| ν–‰μ„μ | μ—­ν•  |
|--------|------|
| κ³ κ° (Customer) | μ£Όλ¬Έ μƒμ„±, κ²°μ , μ·¨μ† |
| λ μ¤ν† λ‘ (Restaurant) | μ£Όλ¬Έ μ ‘μ/κ±°μ , μ΅°λ¦¬ |
| λΌμ΄λ” (Rider) | ν”½μ—…, λ°°λ‹¬ |

### π”Ή μ£Όλ¬Έ(Order)μ ν•µμ‹¬ μƒλ…μ£ΌκΈ°

```mermaid
stateDiagram-v2
    [*] --> pending_payment: μ£Όλ¬Έ μƒμ„±
    pending_payment --> payment_failed: κ²°μ  μ‹¤ν¨
    pending_payment --> pending_acceptance: κ²°μ  μ„±κ³µ
    pending_payment --> cancelled: κ²°μ  μ „ μ·¨μ†
    pending_acceptance --> rejected: μ£Όλ¬Έ κ±°μ 
    pending_acceptance --> cancelled: μ ‘μ μ „ μ·¨μ†
    pending_acceptance --> preparing: μ£Όλ¬Έ μ ‘μ
    preparing --> ready_for_pickup: μ΅°λ¦¬ μ™„λ£
    ready_for_pickup --> in_transit: ν”½μ—… μ™„λ£
    in_transit --> delivered: λ°°λ‹¬ μ™„λ£
    delivered --> [*]
    cancelled --> [*]
    rejected --> [*]
    payment_failed --> [*]
```

| μƒνƒ | μ„¤λ… | μ „μ΄ κ°€λ¥ ν–‰μ„ |
|------|------|---------------|
| `pending_payment` | κ²°μ  λ€κΈ°μ¤‘ | payment, cancellation |
| `payment_failed` | κ²°μ  μ‹¤ν¨ | (μΆ…λ£ μƒνƒ) |
| `pending_acceptance` | μ£Όλ¬Έ μ ‘μ λ€κΈ°μ¤‘ | acceptance, rejection, cancellation |
| `rejected` | μ£Όλ¬Έ κ±°μ λ¨ | (μΆ…λ£ μƒνƒ) |
| `cancelled` | μ£Όλ¬Έ μ·¨μ†λ¨ | (μΆ…λ£ μƒνƒ) |
| `preparing` | μ΅°λ¦¬μ¤‘ | preparation-complete |
| `ready_for_pickup` | ν”½μ—… λ€κΈ°μ¤‘ | pickup |
| `in_transit` | λ°°λ‹¬μ¤‘ | delivery |
| `delivered` | λ°°λ‹¬ μ™„λ£ | (μΆ…λ£ μƒνƒ) |

---

### π”Ή μ‹¤ν–‰ κ°€μ΄λ“

```bash
# 1. κ°€μƒν™κ²½ μƒμ„± λ° ν™μ„±ν™”
python -m venv venv
venv\Scripts\activate  # Windows
# 2. ν¨ν‚¤μ§€ μ„¤μΉ
pip install -r requirements.txt
# 3. λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…
python manage.py migrate
# 4. κ΄€λ¦¬μ κ³„μ • μƒμ„±
python manage.py createsuperuser
# 5. μ„λ²„ μ‹¤ν–‰
python manage.py runserver
====== TEST CODE μ‹¤ν–‰ ======
# 6. Race Condition ν…μ¤νΈ (λ³„λ„ ν„°λ―Έλ„)
python black_BOX_test_v1.0.py
# 7. λ©±λ“±μ„± ν…μ¤νΈ
python black_BOX_test.py
# 8. V2 API ν…μ¤νΈ
python manage.py test orders.tests_v2
# 9. N+1 μΏΌλ¦¬ ν…μ¤νΈ
python manage.py test orders.tests_nplus1
============================================
http://127.0.0.1:8000/api/v1/orders/    μ£Όλ¬Έ λ©λ΅ μ΅°ν / μƒ μ£Όλ¬Έ μƒμ„±
http://127.0.0.1:8000/api/v1/orders/n/  nλ² μ£Όλ¬Έ μƒμ„Έ μ΅°ν / μμ •
http://127.0.0.1:8000/api/v2/orders/    μ£Όλ¬Έ λ©λ΅ μ΅°ν / μƒ μ£Όλ¬Έ μƒμ„±
http://127.0.0.1:8000/api/v2/orders/n/  nλ² μ£Όλ¬Έ μƒμ„Έ μ΅°ν / μμ •
http://127.0.0.1:8000/admin/            κ΄€λ¦¬μ νμ΄μ§€
```

### π”Ή μ£Όμ” μ—”λ“ν¬μΈνΈ

| λ²„μ „ | μ—”λ“ν¬μΈνΈ | μ„¤λ… |
|------|-----------|------|
| V1 | `GET /api/v1/orders/` | μ£Όλ¬Έ λ©λ΅ μ΅°ν |
| V1 | `PUT /api/v1/orders/{id}/` | μƒνƒ λ³€κ²½ (λ¬Έμ  μμ) |
| V2 | `GET /api/v2/orders/` | μ£Όλ¬Έ λ©λ΅ μ΅°ν |
| V2 | `POST /api/v2/orders/{id}/payment/` | κ²°μ  μ²λ¦¬ |
| V2 | `POST /api/v2/orders/{id}/cancellation/` | μ£Όλ¬Έ μ·¨μ† |
| V2 | `POST /api/v2/orders/{id}/acceptance/` | μ£Όλ¬Έ μ ‘μ |
| - | `/admin/` | Django κ΄€λ¦¬μ νμ΄μ§€ |



```
B2_baedal/
β”β”€β”€ manage.py                 # Django κ΄€λ¦¬ λ…λ Ήμ–΄
β”β”€β”€ requirements.txt          # μμ΅΄μ„± ν¨ν‚¤μ§€
β”β”€β”€ black_BOX_test_v1.0.py    # π”ΊRace Condition ν…μ¤νΈ
β”β”€β”€ README.md                 # ν”„λ΅μ νΈ λ¬Έμ„
β”‚
β”β”€β”€ quickeats/                # ν”„λ΅μ νΈ μ„¤μ •
β”‚   β”β”€β”€ settings.py           # Django μ„¤μ • (DB, μ•± λ“±)
β”‚   β”β”€β”€ urls.py               # λ©”μΈ URL λΌμ°ν„°
β”‚   β””β”€β”€ wsgi.py
β”‚
β””β”€β”€ orders/                   # μ£Όλ¬Έ μ•± (ν•µμ‹¬)
    β”β”€β”€ models.py             # Order λ¨λΈ + μƒνƒ μ •μ
    β”β”€β”€ views.py              # V1 ViewSet (λ¬Έμ  μλ” λ²„μ „)
    β”β”€β”€ urls.py               # URL λΌμ°ν… (v1, v2)
    β”β”€β”€ serializers.py        # V1 Serializer
    β”β”€β”€ admin.py              # κ΄€λ¦¬μ νμ΄μ§€ μ„¤μ •
    β”β”€β”€ tests_nplus1.py       # (N+1 λ¬Έμ )κ΄€λ ¨ ν…μ¤νΈ
    β”β”€β”€ tests_v2.py           # V2 ν…μ¤νΈ
    β”‚
    β””β”€β”€ api/v2/               # V2 API (κ°μ„ λ λ²„μ „)
        β”β”€β”€ views.py          # ν–‰μ„ κΈ°λ° ViewSet
        β”β”€β”€ urls.py           # V2 λΌμ°ν„°
        β””β”€β”€ serializers.py    # V2 Serializer
```


| ν•µμ‹¬ μ›μΉ™ | κµ¬ν„ λ°©λ²• | ν•΄κ²°ν•λ” λ¬Έμ  |
|-----------|-----------|---------------|
| μƒνƒ λ¨Έμ‹  λ¨λΈλ§ | ν–‰μ„ κΈ°λ° λ¦¬μ†μ¤ μ—”λ“ν¬μΈνΈ | λ¨νΈν• μƒνƒ μ „μ΄, λΉ„μ¦λ‹μ¤ κ·μΉ™ νΌμ¬ |
| λ©±λ“±μ„± λ³΄μ¥ | Idempotency-Key ν—¤λ” | λ„¤νΈμ›ν¬ μ¤λ¥ μ‹ μ¤‘λ³µ μ²λ¦¬ |
| λ‚™κ΄€μ  λ½ | ETag + If-Match ν—¤λ” | λ™μ‹μ„± μ¶©λ (Race Condition) |
| ν¨μ¨μ  λ°μ΄ν„° μ κ³µ | μ‚¬μ΄λ“λ΅λ”© / GraphQL | N+1 λ¬Έμ , κ³Όλ‹¤/λ¶€μ΅± λ°μ΄ν„° μ „μ†΅ |
| λ²„μ „ κ΄€λ¦¬ | URI κ²½λ΅ κΈ°λ° λ²„μ „ κ΄€λ¦¬ | κΈ°μ΅΄ ν΄λΌμ΄μ–ΈνΈ νΈν™μ„± |

---

### π”Ή κµ¬ν„ ν„ν™©

μ΄ μλ£λ¥Ό λ°”νƒ•μΌλ΅ λ‹¤μμ„ κµ¬ν„:

- [x] V2 REST API μ„¤κ³„ λ° κµ¬ν„
- [x] ν–‰μ„ κΈ°λ° λ¦¬μ†μ¤ μ—”λ“ν¬μΈνΈ κµ¬μ¶• (7κ° μ™„λ£)
- [x] API λ²„μ „ κ΄€λ¦¬ μ²΄κ³„ μλ¦½ (`/api/v1/`, `/api/v2/`)
- [x] Idempotency-Key κΈ°λ° λ©±λ“±μ„± λ³΄μ¥ λ―Έλ“¤μ›¨μ–΄
- [x] ETag/If-Match κΈ°λ° λ‚™κ΄€μ  λ½ κµ¬ν„
- [x] μ‚¬μ΄λ“λ΅λ”© κΈ°λ¥ κµ¬ν„ (`?include=`)

#### κµ¬ν„λ V2 μ—”λ“ν¬μΈνΈ

| μ—”λ“ν¬μΈνΈ | ν–‰μ„μ | ν—μ© μƒνƒ | κ²°κ³Ό μƒνƒ |
|-----------|--------|----------|----------|
| `POST /orders/{id}/payment/` | κ³ κ° | pending_payment | pending_acceptance |
| `POST /orders/{id}/cancellation/` | κ³ κ° | pending_payment, pending_acceptance | cancelled |
| `POST /orders/{id}/acceptance/` | λ μ¤ν† λ‘ | pending_acceptance | preparing |
| `POST /orders/{id}/rejection/` | λ μ¤ν† λ‘ | pending_acceptance | rejected |
| `POST /orders/{id}/preparation-complete/` | λ μ¤ν† λ‘ | preparing | ready_for_pickup |
| `POST /orders/{id}/pickup/` | λΌμ΄λ” | ready_for_pickup | in_transit |
| `POST /orders/{id}/delivery/` | λΌμ΄λ” | in_transit | delivered |

---

### π”Ή ν–¥ν›„ ν™•μ¥ λ° κ°μ„  κ³„ν (Future Plans)

ν„μ¬μ V2 APIλ” ν•µμ‹¬ μ£Όλ¬Έ λ΅μ§μ μ •ν•©μ„±μ„ ν™•λ³΄ν•λ” λ° μ§‘μ¤‘ν–μµλ‹λ‹¤.  
μ‹¤μ  μƒμ© μμ¤€μ λ€κ·λ¨ νΈλν”½μ„ μ²λ¦¬ν•κ³  μ„λΉ„μ¤λ¥Ό ν™•μ¥ν•κΈ° μ„ν•΄ λ‹¤μκ³Ό κ°™μ€ κΈ°μ μ  κ°μ„ λ“¤μ΄ κ³„νλμ–΄ μμµλ‹λ‹¤.

##### 1. μΈμ¦ λ° μΈκ°€ κ³ λ„ν™” (Authentication & Authorization)
- **ν„ν™©**: ν„μ¬λ” κ°„λ‹¨ν• μ„Έμ… κΈ°λ° λλ” κ°λ° νΈμλ¥Ό μ„ν• μ—΄λ¦° κµ¬μ΅°μ…λ‹λ‹¤.
- **κ³„ν**: 
  - **JWT (JSON Web Token)** λ„μ…μΌλ΅ Statelessν• μΈμ¦ μ²΄κ³„ κµ¬μ¶•.
  - **RBAC (Role-Based Access Control)** λ―Έλ“¤μ›¨μ–΄λ¥Ό λ„μ…ν•μ—¬ κ³ κ°/μ μ£Ό/λΌμ΄λ”μ κ¶ν•μ„ API λ λ²¨μ—μ„ μ—„κ²©ν•κ² λ¶„λ¦¬.

##### 2. λΉ„λ™κΈ° μ‘μ—… μ²λ¦¬ (Asynchronous Processing)
- **ν„ν™©**: μ£Όλ¬Έ μ²λ¦¬ λ΅μ§μ΄ λ™κΈ°(Synchronous) λ°©μ‹μΌλ΅ κµ¬ν„λμ–΄ μμµλ‹λ‹¤.
- **κ³„ν**: 
  - **Celery + Redis**λ¥Ό λ„μ…ν•μ—¬ 'μ•λ¦Ό λ°μ†΅', 'λ°°λ‹¬λ£ μ •μ‚°', 'ν†µκ³„ μ§‘κ³„' λ“± μ‹κ°„μ΄ μ¤λ κ±Έλ¦¬λ” μ‘μ—…μ„ λ°±κ·ΈλΌμ΄λ“ νλ΅ μ΄κ΄€.
  - μ‚¬μ©μ μ‘λ‹µ μ†λ„ ν–¥μƒ λ° μ„λ²„ λ¦¬μ†μ¤ ν¨μ¨ν™”.

##### 3. μ‹¤μ‹κ°„ μ„μΉ κ΄€μ  (Real-time Communication)
- **ν„ν™©**: λΌμ΄λ” μ„μΉλ‚ μ£Όλ¬Έ μƒνƒ λ³€κ²½μ„ ν™•μΈν•λ ¤λ©΄ ν΄λΌμ΄μ–ΈνΈκ°€ μ£ΌκΈ°μ μΌλ΅ Pollingν•΄μ•Ό ν•©λ‹λ‹¤.
- **κ³„ν**: 
  - **WebSockets (Django Channels)** λ„μ….
  - λΌμ΄λ”μ μ‹¤μ‹κ°„ μ„μΉλ¥Ό μ§€λ„μ— λ§¤ν•‘ν•κ³ , μ£Όλ¬Έ μƒνƒ λ³€κ²½ μ‹ ν‘Έμ‹ μ•λ¦Όμ„ μ „μ†΅ν•λ” μ–‘λ°©ν–¥ ν†µμ‹  κµ¬ν„.

##### 4. λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ•„ν‚¤ν…μ² (MSA) μ „ν™ μ¤€λΉ„
- **ν„ν™©**: λ‹¨μΌ λ¨λ†€λ¦¬μ‹(Monolithic) Django μ•± κµ¬μ΅°μ…λ‹λ‹¤.
- **κ³„ν**: 
  - λ„λ©”μΈ λ³µμ΅λ„κ°€ μ¦κ°€ν•¨μ— λ”°λΌ **μ£Όλ¬Έ(Order)**, **κ²°μ (Payment)**, **λ°°λ‹¬(Delivery)** μ„λΉ„μ¤λ¥Ό λ…λ¦½μ μΌλ΅ λ¶„λ¦¬.
  - μ„λΉ„μ¤ κ°„ ν†µμ‹ μ„ μ„ν•΄ **Kafka** λλ” **RabbitMQ**μ™€ κ°™μ€ λ©”μ‹μ§€ λΈλ΅μ»¤ λ„μ…ν•μ—¬ κ²°ν•©λ„ κ°μ†.

##### 5. λ¨λ‹ν„°λ§ λ° ν…μ¤νΈ μλ™ν™” (Observability & CI/CD)
- **κ³„ν**: 
  - **Sentry** μ—°λ™μΌλ΅ μ‹¤μ‹κ°„ μ—λ¬ μ¶”μ .
  - **Prometheus & Grafana**λ¥Ό ν™μ©ν• API μ”μ²­λ‰ λ° μ‘λ‹µ μ§€μ—°μ‹κ°„ λ¨λ‹ν„°λ§ μ‹μ¤ν… κµ¬μ¶•.
  - GitHub Actionsλ¥Ό ν†µν• **CI/CD νμ΄ν”„λΌμΈ** κµ¬μ¶•μΌλ΅ λ°°ν¬ μλ™ν™”.